<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é§¿é‘« è¦æ ¼ç”¢ç”Ÿå™¨</title>
  
  <link rel="stylesheet" href="report.css">
  <link rel="stylesheet" href="navbar.css"> 
  <style>
  /* ç§»é™¤ JS PCB æµ®æ°´å°æ¨£å¼ */
  body::before { content: none !important; }

  /* é‡å°æ–°çš„å ±è¡¨çµæ§‹èª¿æ•´ä¸»è¦å®¹å™¨ */
  body {
    background-color: #f5f5f5;
    margin: 0;
    font-family: 'Noto Sans TC', sans-serif;
  }
  
  /* è¦†å¯«èˆŠçš„ main-containerï¼Œæ¡ç”¨æ–°çš„ page-container çµæ§‹ */
  .main-container { width: 100%; margin: 0 auto; padding: 0; }
  
  /* éš±è—èˆŠçš„æ¨™é¡Œ */
  .logo-wrap, h1.page-title { display: none; } 

  /* èª¿æ•´ field-group æ¨£å¼ */
  .info-grid-custom {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px; 
      margin-bottom: 25px; 
  }

  .info-item-custom {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #ddd;
      padding-bottom: 2px;
      height: 34px; 
  }

  .info-item-custom .label {
      background-color: var(--label-bg, #f0ebde);
      color: #333;
      font-weight: 700;
      font-size: 14px;
      padding: 3px 10px;
      border-radius: 4px;
      width: 85px; 
      text-align: center;
      margin-right: 8px;
      flex-shrink: 0;
      border: 1px solid var(--border-color, #e0d8c8);
  }
  
  .info-content-wrap {
      flex-grow: 1;
      display: flex;
      align-items: center;
      gap: 8px;
  }

  .warning {
      color: #ef4444; 
      font-size: 13px;
      margin-left: 93px; 
      margin-top: 5px; 
      padding-left: 35px; 
      margin-bottom: -5px; 
  }

  .input-line-custom {
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 4px;
      outline: none;
      font-size: 14px;
      font-family: 'Noto Sans TC', sans-serif;
      width: 100%;
      padding: 4px 8px;
      color: #000;
      transition: all 0.2s ease;
  }
  .input-line-custom:focus {
      border-color: var(--gold-dark);
      box-shadow: 0 0 0 3px rgba(179, 135, 40, 0.1);
  }
  
  .custom-input-wrapper {
    display: none;
    width: 100%;
    align-items: center;
    gap: 5px;
  }

  .custom-input-wrapper input {
    flex-grow: 1;
    width: auto !important; 
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 14px;
  }
  
  .reset-btn {
    width: 24px;
    height: 24px;
    line-height: 1;
    font-size: 14px;
    flex-shrink: 0;
  }
  
  /* A4 è¦æ ¼ */
  .page-container {
      width: 100%;
      display: flex;
      justify-content: center;
      padding: 20px; 
      padding-bottom: 40px; 
      box-sizing: border-box;
  }

  .a4-paper {
      width: 210mm; 
      min-height: 297mm; 
      background: var(--bg-page);
      padding: 15mm 15mm; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      position: relative;
      margin: 0; 
  }

  /* å‚™è¨»æ¬„ä½èˆ‡è¼¸å‡ºå€å¡Š */
  .remarks-container { margin-bottom: 20px; }
  .remarks-input { min-height: 90px !important; resize: vertical; }

  .output-area {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background-color: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  #output-text {
    width: 90%; 
    min-height: 400px; 
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    line-height: 1.6;
    resize: vertical;
    display: block;
    margin: 0 auto;
  }

  .output-label {
      font-size: 14px;
      font-weight: 700;
      color: #333;
      margin-bottom: 5px;
      display: block;
  }

  .btn-row {
      display: flex;
      justify-content: center; 
      gap: 15px; 
      margin: 20px 0 20px 0; 
  }

  /* æ‰‹æ©ŸéŸ¿æ‡‰å¼èª¿æ•´ */
  @media (max-width: 768px) {
      .page-container { padding: 5px; padding-bottom: 20px !important; }
      .a4-paper { width: 100%; min-height: auto; padding: 15px; box-shadow: none; margin: 0; }
      
      #output-text { width: 90% !important; margin: 0 auto !important; }

      .warning {
          margin-left: 93px !important; 
          margin-top: 5px; 
          padding-left: 35px !important; 
          margin-bottom: -5px;
      }
      
      .info-item-custom {
          display: flex !important;
          flex-direction: row !important; 
          align-items: center !important;
          height: auto; 
          padding-bottom: 5px;
          border-bottom: 1px solid #ddd;
      }

      .info-item-custom .label {
          width: 85px !important; 
          margin-right: 8px !important;
          margin-bottom: 0px !important;
          flex-shrink: 0 !important;
          text-align: center; 
      }
      
      .info-content-wrap { width: auto !important; flex-grow: 1 !important; }
      .btn-row { flex-direction: column; align-items: stretch; }
  }

</style>
</head>
<body>

<div id="navbar-container"></div>
<script src="navbar.js"></script>

<div class="page-container">
    <div class="a4-paper">
        
        <div id="unified-header-container" data-title="è¦æ ¼ç”¢ç”Ÿå™¨" data-simple="true"></div>
        
        <section class="info-grid-custom">
            
            <div class="info-item-custom">
                <span class="label">æ–™è™Ÿ</span>
                <div class="info-content-wrap">
                    <input type="text" id="partNo" class="input-line-custom" placeholder="è«‹è¼¸å…¥æ–™è™Ÿ" />
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ¿æ</span>
                    <div class="info-content-wrap">
                        <select id="material" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option selected>FR-4</option>
                            <option>FR-1</option>
                            <option>é‹åŸºæ¿</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="material_custom_div" class="custom-input-wrapper">
                            <input type="text" id="material_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ¿æ" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('material')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="materialWarning" class="warning" style="display:none;">
                    FR-1 äº¤æœŸè¼ƒé•·ï¼Œå»ºè­°ä»¥ FR-4 è£½ä½œ
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">å±¤åˆ¥</span>
                    <div class="info-content-wrap">
                        <select id="layers" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>å–®é¢æ¿</option>
                            <option selected>é›™é¢æ¿</option>
                            <option>å››å±¤æ¿</option>
                            <option>å…­å±¤æ¿</option>
                            <option>å…«å±¤æ¿</option>
                            <option>åå±¤æ¿</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="layers_custom_div" class="custom-input-wrapper">
                            <input type="text" id="layers_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥å±¤åˆ¥" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('layers')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ¿åš</span>
                    <div class="info-content-wrap">
                        <select id="thickness" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option value="0.4 mm">0.4 mm</option>
                            <option value="0.6 mm">0.6 mm</option>
                            <option value="0.8 mm">0.8 mm</option>
                            <option value="1.0 mm">1.0 mm</option>
                            <option value="1.2 mm">1.2 mm</option>
                            <option value="1.6 mm" selected>1.6 mm</option>
                            <option value="2.0 mm">2.0 mm</option>
                            <option value="2.4 mm">2.4 mm</option>
                            <option value="3.0 mm">3.0 mm</option>
                            <option value="3.2 mm">3.2 mm</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="thickness_custom_div" class="custom-input-wrapper">
                            <input type="text" id="thickness_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ¿åš" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('thickness')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="thicknessWarning" class="warning" style="display:none;">
                    æ¿åš 0.4 mm å¤ªè–„ï¼Œç„¡æ³•é€²è¡Œ V-Cutã€‚è‹¥éœ€æ‹¼æ¿ï¼Œå»ºè­°æ¡ç”¨éƒµç¥¨å­”è¨­è¨ˆã€‚
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">å…§å±¤éŠ…åš</span>
                    <div class="info-content-wrap">
                        <select id="innerCu" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>0.5oz</option>
                            <option>1oz</option>
                            <option>2oz</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="innerCu_custom_div" class="custom-input-wrapper">
                            <input type="text" id="innerCu_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥å…§å±¤éŠ…åš" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('innerCu')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="innerCuWarning" class="warning" style="display:none;">
                    å–®é¢æ¿ã€é›™é¢æ¿ä¸æ”¯æ´å…§å±¤éŠ…åš
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">å¤–å±¤éŠ…åš</span>
                    <div class="info-content-wrap">
                        <select id="outerCu" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option selected>1oz</option>
                            <option>2oz</option>
                            <option>3oz</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="outerCu_custom_div" class="custom-input-wrapper">
                            <input type="text" id="outerCu_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥å¤–å±¤éŠ…åš" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('outerCu')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">é˜²ç„Šé¡è‰²</span>
                    <div class="info-content-wrap">
                        <select id="solderMask" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option value="ç¶ è‰²" selected>ğŸŸ¢ ç¶ è‰²</option>
                            <option value="è—è‰²">ğŸ”µ è—è‰²</option>
                            <option value="é»‘è‰²">âš« é»‘è‰²</option>
                            <option value="ç™½è‰²">âšª ç™½è‰²</option>
                            <option value="ç´…è‰²">ğŸ”´ ç´…è‰²</option>
                            <option value="é»ƒè‰²">ğŸŸ¡ é»ƒè‰²</option>
                            <option value="ç„¡"> ç„¡</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="solderMask_custom_div" class="custom-input-wrapper">
                            <input type="text" id="solderMask_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥é˜²ç„Šé¡è‰²" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('solderMask')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ–‡å­—é¡è‰²</span>
                    <div class="info-content-wrap">
                        <select id="legendColor" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option value="ç™½å­—" selected>âšª ç™½å­—</option>
                            <option value="é»‘å­—">âš« é»‘å­—</option>
                            <option value="ç„¡æ–‡å­—">ç„¡æ–‡å­—</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="legendColor_custom_div" class="custom-input-wrapper">
                            <input type="text" id="legendColor_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ–‡å­—é¡è‰²" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('legendColor')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">è¡¨é¢è™•ç†</span>
                    <div class="info-content-wrap">
                        <select id="finish" class="input-line-custom" onchange="onSelectChange(this)">
                            <option value="-">-</option>
                            <option value="æœ‰é‰›å™´éŒ«">æœ‰é‰›å™´éŒ«</option>
                            <option value="ç„¡é‰›å™´éŒ«" selected>ç„¡é‰›å™´éŒ«</option>
                            <option value="åŒ–é‡‘ 1u">åŒ–é‡‘ 1u"</option>
                            <option value="åŒ–é‡‘ 2u">åŒ–é‡‘ 2u"</option>
                            <option value="åŒ–é‡‘ 3u">åŒ–é‡‘ 3u"</option>
                            <option value="ç¡¬é‡‘ 3u">ç¡¬é‡‘ 3u"</option>
                            <option value="ç¡¬é‡‘ 5u">ç¡¬é‡‘ 5u"</option>
                            <option value="OSP">OSP</option>
                            <option value="è£¸éŠ…">è£¸éŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="finish_custom_div" class="custom-input-wrapper">
                            <input type="text" id="finish_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥è¡¨é¢è™•ç†" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('finish')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="finishWarning" class="warning" style="display:none;">
                    å…­å±¤æ¿ä»¥ä¸Šï¼Œçµ±ä¸€è£½åšåŒ–é‡‘ 2u è¡¨é¢è™•ç†
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">é‡‘(éŒ«)æ‰‹æŒ‡</span>
                    <div class="info-content-wrap">
                        <select id="goldFinger" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>æ–œé‚Š30Â°</option>
                            <option>æ–œé‚Š45Â°</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="goldFinger_custom_div" class="custom-input-wrapper">
                            <input type="text" id="goldFinger_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥é‡‘(éŒ«)æ‰‹æŒ‡" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('goldFinger')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ•¸é‡(å‡ºè²¨ç‰‡)</span>
                    <div class="info-content-wrap">
                        <select id="qty" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option selected>5</option>
                            <option>10</option>
                            <option>15</option>
                            <option>20</option>
                            <option>25</option>
                            <option>30</option>
                            <option>50</option>
                            <option>75</option>
                            <option>100</option>
                            <option>125</option>
                            <option>150</option>
                            <option>200</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="qty_custom_div" class="custom-input-wrapper">
                            <input type="text" id="qty_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ•¸é‡" class="input-line-custom" oninput="formatNumber(this)" />
                            <button type="button" class="reset-btn" onclick="resetSelect('qty')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">ç‰¹æ®Šè£½ç¨‹#1</span>
                    <div class="info-content-wrap">
                        <select id="special1" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>åŠå­”</option>
                            <option>å¡å­”</option>
                            <option>æ¨¹è„‚å¡å­”</option>
                            <option>BGA</option>
                            <option>å´é‚ŠééŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="special1_custom_div" class="custom-input-wrapper">
                            <input type="text" id="special1_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥ç‰¹æ®Šè£½ç¨‹" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('special1')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="special1Warning" class="warning" style="display:none;">
                    å…­å±¤æ¿ä»¥ä¸Šï¼Œçµ±ä¸€è£½ä½œæ¨¹è„‚å¡å­”è£½ç¨‹
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">ç‰¹æ®Šè£½ç¨‹#2</span>
                    <div class="info-content-wrap">
                        <select id="special2" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>åŠå­”</option>
                            <option>å¡å­”</option>
                            <option>æ¨¹è„‚å¡å­”</option>
                            <option>BGA</option>
                            <option>å´é‚ŠééŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="special2_custom_div" class="custom-input-wrapper">
                            <input type="text" id="special2_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥ç‰¹æ®Šè£½ç¨‹" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('special2')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">ç‰¹æ®Šè£½ç¨‹#3</span>
                    <div class="info-content-wrap">
                        <select id="special3" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>åŠå­”</option>
                            <option>å¡å­”</option>
                            <option>æ¨¹è„‚å¡å­”</option>
                            <option>BGA</option>
                            <option>å´é‚ŠééŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="special3_custom_div" class="custom-input-wrapper">
                            <input type="text" id="special3_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥ç‰¹æ®Šè£½ç¨‹" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('special3')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-item-custom">
                <span class="label">è¨‚å–®é‡‘é¡</span>
                <div class="info-content-wrap">
                    <input type="text" id="specialAmount" inputmode="numeric" oninput="formatNumber(this)" placeholder="è«‹è¼¸å…¥é‡‘é¡" class="input-line-custom" />
                </div>
            </div>

        </section>

        <div id="unified-remarks-container"></div>
        
        <div class="btn-row">
            <button type="button" class="btn-glass-base btn-glass-gold" onclick="generateAndCopyText()">ä¸€éµç”Ÿæˆ+è¤‡è£½</button>
            <button type="button" class="btn-glass-base btn-glass-blue" onclick="generateText()">ç”Ÿæˆæ–‡å­—</button>
            <button type="button" class="btn-glass-base btn-glass-gray" onclick="copyText()">è¤‡è£½æ–‡å­—</button>
        </div>

        <div class="output-area">
            <span class="output-label">è¦æ ¼è¨Šæ¯</span>
            <textarea id="output-text" placeholder="é»æ“Šã€Œç”Ÿæˆæ–‡å­—ã€æŒ‰éˆ•å¾Œï¼Œæœƒåœ¨æ­¤è™•é¡¯ç¤ºå®Œæ•´çš„ PCB è¦æ ¼è³‡è¨Š"></textarea>
        </div>

    </div>
</div>

<script src="template.js"></script>

<script>
  
  // æ ¼å¼åŒ–æ•¸å­— (æ•¸é‡/é‡‘é¡æ¬„ä½)
  function formatNumber(input) {
    var value = input.value.replace(/\D/g, "");
    if (value) {
      input.value = Number(value).toLocaleString("en-US");
    } else {
      input.value = "";
    }
  }

  // æª¢æŸ¥æ˜¯å¦é¸ä¸­è‡ªè¨‚è¼¸å…¥
  function checkCustom(selectEl) {
    if (selectEl.value === 'custom') {
      var customDivId = selectEl.id + '_custom_div';
      var customDiv = document.getElementById(customDivId);
      var customInput = document.getElementById(selectEl.id + '_custom');
      if (customDiv) {
        selectEl.style.display = 'none';
        customDiv.style.display = 'flex';
        if(customInput) customInput.focus();
      }
      return true;
    }
    return false;
  }

  // é‡ç½®å›é¸å–®
  function resetSelect(selectId) {
    var selectEl = document.getElementById(selectId);
    var customDiv = document.getElementById(selectId + '_custom_div');
    var customInput = document.getElementById(selectId + '_custom');
    if (selectEl && customDiv) {
      customDiv.style.display = 'none';
      customInput.value = ''; // æ¸…ç©ºè‡ªè¨‚å…§å®¹
      selectEl.style.display = 'block';
      selectEl.value = '-';
      updateStates();
    }
  }

  function onSelectChange(el) {
    checkCustom(el);
    updateStates();
  }
  
  function generateAndCopyText() {
    generateText(); // å…ˆç”Ÿæˆæ–‡å­—
    copyText();     // å†è¤‡è£½æ–‡å­—
  }

  // ğŸ’¡ [æ–°å¢] ç•¶è‡ªè¨‚è¼¸å…¥æ¡†å¤±å»ç„¦é»ä¸”ç‚ºç©ºæ™‚ï¼Œè‡ªå‹•åˆ‡æ›å›é¸å–®
  document.addEventListener('DOMContentLoaded', function() {
      // ç¶å®šæ‰€æœ‰è‡ªè¨‚è¼¸å…¥æ¡†
      document.querySelectorAll('.custom-input-wrapper input').forEach(input => {
          input.addEventListener('blur', function() {
              if (this.value.trim() === '') {
                  // ID è¦å‰‡æ˜¯ xxx_custom -> xxx
                  const selectId = this.id.replace('_custom', '');
                  resetSelect(selectId);
              }
          });
      });
      updateStates();
  });

  // PCB è¦æ ¼é€£å‹•è¦å‰‡è¡¨
  const SPEC_RULES = {
      // é–å®š/é è¨­ (Disabled/Default)
      locks: [
          // å…­å±¤ä»¥ä¸Šï¼šè¡¨é¢è™•ç†å¼·åˆ¶åŒ–é‡‘ 2u
          { rule: (material, layers) => ['å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            target: 'finish', 
            action: (sel) => { sel.value = 'åŒ–é‡‘ 2u'; sel.disabled = true; document.getElementById('finishWarning').style.display = 'block'; } },
          
          // å…­å±¤ä»¥ä¸Šï¼šç‰¹æ®Šè£½ç¨‹å¼·åˆ¶æ¨¹è„‚å¡å­”
          { rule: (material, layers) => ['å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            target: 'special1', 
            action: (sel) => { sel.value = 'æ¨¹è„‚å¡å­”'; sel.disabled = true; document.getElementById('special1Warning').style.display = 'block'; } },
      ],
      // äº’æ–¥/é™åˆ¶ (Exclusion/Restriction)
      restrictions: [
          // FR-1 æ¿æé™åˆ¶
          { rule: (material) => material === 'FR-1', 
            targets: [
              { id: 'layers', disable_values: ['é›™é¢æ¿', 'å››å±¤æ¿', 'å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'], default_value: 'å–®é¢æ¿', warning: 'materialWarning' },
              { id: 'thickness', disable_values: ['0.4 mm', '0.6 mm', '0.8 mm', '1.0 mm', '1.2 mm', '2.0 mm', '2.4 mm', '3.0 mm', '3.2 mm'], default_value: '1.6 mm' },
              { id: 'outerCu', disable_values: ['2oz', '3oz'], default_value: '1oz' },
              { id: 'goldFinger', disable_all: true, default_value: '-' },
              { id: 'special1', disable_all: true, default_value: '-' },
              { id: 'special2', disable_all: true, default_value: '-' },
              { id: 'special3', disable_all: true, default_value: '-' },
              { id: 'innerCu', disable_all: true, default_value: '-', warning: 'innerCuWarning' }
            ]
          },
          // å–®/é›™é¢æ¿ä¸éœ€å…§å±¤éŠ…åš
          { rule: (material, layers) => ['å–®é¢æ¿', 'é›™é¢æ¿'].includes(layers), 
            targets: [
              { id: 'innerCu', disable_all: true, default_value: '-', warning: 'innerCuWarning' }
            ]
          },
          // å››å±¤ä»¥ä¸Šæ¿åšé™åˆ¶
          { rule: (material, layers) => ['å››å±¤æ¿', 'å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            targets: [
              { id: 'thickness', disable_values: ['0.4 mm'], warning: 'thicknessWarning' }
            ]
          },
          // å…«å±¤ä»¥ä¸Šæ¿åšé™åˆ¶
          { rule: (material, layers) => ['å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            targets: [
              { id: 'thickness', disable_values: ['0.4 mm', '0.6 mm'], warning: 'thicknessWarning' }
            ]
          }
      ],
      // é è¨­å€¼ (Defaults)
      defaults: [
          // å››å±¤æ¿ä»¥ä¸Šé è¨­å…§å±¤éŠ…åš
          { rule: (material, layers) => layers !== 'å–®é¢æ¿' && layers !== 'é›™é¢æ¿' && layers !== '-' && layers !== 'custom', 
            target: 'innerCu', 
            action: (sel, currentVal) => { if (currentVal === '-' || currentVal === '') sel.value = '0.5oz'; } }
      ]
  };

  function updateStates() {
    const currentValues = {
      material: getValue("material"),
      layers: getValue("layers"),
      thickness: getValue("thickness"),
      innerCu: getValue("innerCu"),
      finish: getValue("finish"),
      special1: getValue("special1")
    };
    
    // 1. é‡ç½®æ‰€æœ‰å—å½±éŸ¿çš„æ¬„ä½ç‹€æ…‹ (Selects & Warnings)
    document.querySelectorAll('select').forEach(sel => {
        if (sel.id.startsWith('special') || sel.id === 'layers' || sel.id === 'thickness' || sel.id === 'innerCu' || sel.id === 'finish' || sel.id === 'outerCu' || sel.id === 'goldFinger') {
            sel.disabled = false;
            // é‡æ–°å•Ÿç”¨æ‰€æœ‰ Option
            Array.from(sel.options).forEach(opt => opt.disabled = false);
        }
    });
    document.querySelectorAll('.warning').forEach(warn => warn.style.display = 'none');

    // 2. è™•ç†äº’æ–¥/é™åˆ¶ (Restrictions)
    SPEC_RULES.restrictions.forEach(restriction => {
        if (restriction.rule(currentValues.material, currentValues.layers)) {
            restriction.targets.forEach(target => {
                const sel = document.getElementById(target.id);
                if (!sel || checkCustom(sel)) return;

                if (target.warning) {
                    const warnEl = document.getElementById(target.warning);
                    if (warnEl) warnEl.style.display = 'block';
                }

                if (target.disable_all) {
                    sel.disabled = true;
                } else if (target.disable_values) {
                    target.disable_values.forEach(val => {
                        const opt = sel.querySelector(`option[value="${val}"]`);
                        if (opt) opt.disabled = true;
                    });
                }

                // æª¢æŸ¥ç•¶å‰å€¼æ˜¯å¦è¢«ç¦ç”¨ï¼Œå¦‚æœæ˜¯å‰‡åˆ‡æ›åˆ°é è¨­å€¼
                const currentOpt = sel.options[sel.selectedIndex];
                if (currentOpt && currentOpt.disabled && sel.value !== 'custom') {
                    sel.value = target.default_value;
                }
            });
        }
    });
    
    // æª¢æŸ¥æ¿åš 0.4 mm è­¦å‘Š (ç¨ç«‹æ–¼ FR-1 é™åˆ¶å¤–)
    const thickness = getValue("thickness");
    if (thickness === "0.4 mm" && currentValues.material !== "FR-1") {
        const thicknessOpt = document.getElementById("thickness").options[document.getElementById("thickness").selectedIndex];
        if (thicknessOpt && !thicknessOpt.disabled) {
            document.getElementById('thicknessWarning').style.display = 'block';
        }
    }


    // 3. è™•ç†é–å®š/é è¨­ (Locks & Defaults)
    SPEC_RULES.locks.forEach(lock => {
        const sel = document.getElementById(lock.target);
        if (lock.rule(currentValues.material, currentValues.layers) && !checkCustom(sel)) {
            lock.action(sel);
        }
    });

    SPEC_RULES.defaults.forEach(defaultRule => {
        const sel = document.getElementById(defaultRule.target);
        if (defaultRule.rule(currentValues.material, currentValues.layers) && !checkCustom(sel)) {
            defaultRule.action(sel, getValue(defaultRule.target));
        }
    });
  }

  function trim(str) {
    return str.replace(/^\s+|\s+$/g, "");
  }

  function getValue(id) {
    var el = document.getElementById(id);
    if (!el) return "";
    
    if (el.tagName === 'SELECT' && el.value === 'custom') {
      var customInput = document.getElementById(id + '_custom');
      if (customInput) {
        var val = trim(customInput.value);
        return val || ""; 
      }
    } else if (id === 'specialAmount') {
      var rawVal = trim(el.value || "");
      return rawVal.replace(/,/g, "") || "";
    }
    
    var v = trim(el.value);
    return v || "";
  }
  
  function generateText() {
    var partNo = getValue("partNo");
    var material = getValue("material");
    var layers = getValue("layers");
    var thickness = getValue("thickness");
    var innerCu = getValue("innerCu");
    var outerCu = getValue("outerCu");
    var solderMask = getValue("solderMask");
    var legendColor = getValue("legendColor");
    var finish = getValue("finish");
    var goldFinger = getValue("goldFinger");
    var qty = getValue("qty");
    var specialAmount = getValue("specialAmount");
    
    var specials = [];
    var specialsIds = ["special1", "special2", "special3"];
    for (var i = 0; i < specialsIds.length; i++) {
      var v = getValue(specialsIds[i]);
      // æ’é™¤è¢«é€£å‹•é–å®šçš„ç‰¹æ®Šè£½ç¨‹#1ï¼Œå¦‚æœå®ƒæ˜¯é è¨­å€¼ä¸”ç‰¹æ®Šè£½ç¨‹#2/3æ²’æœ‰å…¶ä»–å€¼
      if (v && v !== "-" && v !== "è«‹é¸æ“‡") specials.push(v);
    }
    
    var remarksEl = document.querySelector('.remarks-input');
    var remark = remarksEl ? trim(remarksEl.value) : "";
    
    var lines = [
      "æ–™è™Ÿï¼š" + (partNo || "-"),
      "æ¿æï¼š" + (material || "-"),
      "å±¤åˆ¥ï¼š" + (layers || "-"),
      "æ¿åšï¼š" + (thickness || "-")
    ];

    if (layers !== "å–®é¢æ¿" && layers !== "é›™é¢æ¿" && layers !== "" && layers !== "-") {
      lines.push("å…§å±¤éŠ…åšï¼š" + (innerCu || "-"));
    }

    lines.push(
      "å¤–å±¤éŠ…åšï¼š" + (outerCu || "-"),
      "é˜²ç„Šé¡è‰²ï¼š" + (solderMask || "-"),
      "æ–‡å­—é¡è‰²ï¼š" + (legendColor || "-"),
      "è¡¨é¢è™•ç†ï¼š" + (finish || "-")
    );

    if (goldFinger && goldFinger !== "-" && goldFinger !== "è«‹é¸æ“‡") {
      lines.push("é‡‘(éŒ«)æ‰‹æŒ‡ï¼š" + goldFinger);
    }

    lines.push("æ•¸é‡(å‡ºè²¨ç‰‡)ï¼š" + (qty || "-"));

    if (specials.length > 0) {
      // ç¢ºä¿ç‰¹æ®Šè£½ç¨‹åªå‡ºç¾ä¸€æ¬¡ (ä¾‹å¦‚æ¨¹è„‚å¡å­”è¢«é–å®šåˆè¢«é¸åˆ°)
      var uniqueSpecials = Array.from(new Set(specials));
      lines.push("ç‰¹æ®Šè£½ç¨‹ï¼š" + uniqueSpecials.join("ã€"));
    }
    
    if (specialAmount) {
        lines.push("è¨‚å–®é‡‘é¡ï¼š" + Number(specialAmount).toLocaleString("en-US") + "å…ƒ");
    }

    var msg = lines.join("\n");
    
    var now = new Date();
    var timeStr = now.getFullYear() + "/" + 
                  (now.getMonth() + 1).toString().padStart(2, '0') + "/" + 
                  now.getDate().toString().padStart(2, '0') + " " + 
                  now.getHours().toString().padStart(2, '0') + ":" + 
                  now.getMinutes().toString().padStart(2, '0');
    
    msg = timeStr + "\n" + msg;

    if (remark) {
      msg += "\n\nå‚™è¨»ï¼š" + remark;
    }
    
    document.getElementById("output-text").value = msg;
  }

  function copyText() {
    var output = document.getElementById("output-text");
    if (output.value) {
        output.select();
        output.setSelectionRange(0, 99999); 
        document.execCommand("copy");
        alert("æ–‡å­—è¨Šæ¯å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
    } else {
        generateText(); 
        if (output.value) {
            output.select();
            output.setSelectionRange(0, 99999); 
            document.execCommand("copy");
            alert("è¦æ ¼å·²ç”Ÿæˆä¸¦è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
        } else {
            alert("è«‹å…ˆå®Œæˆè¦æ ¼è¼¸å…¥ï¼");
        }
    }
  }
</script>

</body>
</html>