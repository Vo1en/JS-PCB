<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é§¿é‘« è¦æ ¼ç”¢ç”Ÿå™¨</title>
  
  <link rel="stylesheet" href="./js system/report.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50 0L20 60H40L30 100L80 40H60L70 0Z' fill='%23c2a878'/></svg>">

  <style>
  /* å…§åµŒæµé‡‘ç‰¹æ•ˆæ‰€éœ€çš„ CSS */
  :root {
      /* é‡‘è‰²ç³»ä¸»è‰²èª¿ */
      --gold-dark: #b38728;
      --border-color: #a8a8a8;
      --label-bg: #f5f5f5;
      --bg-page: #ffffff;
      --ui-radius: 8px;

      /* æµé‡‘ç‰¹æ•ˆæ¼¸å±¤ */
      --gold-text-gradient: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
  }

  /* æµé‡‘ç‰¹æ•ˆå‹•ç•« */
  @keyframes shine { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }


  /* ç§»é™¤ JS PCB æµ®æ°´å°æ¨£å¼ */
  body::before { content: none !important; }

  /* é‡å°æ–°çš„å ±è¡¨çµæ§‹èª¿æ•´ä¸»è¦å®¹å™¨ */
  body {
    background-color: #f5f5f5;
    margin: 0;
    font-family: 'Noto Sans TC', sans-serif;
    /* èª¿æ•´é ‚éƒ¨ç©ºé–“ï¼šè¦†è“‹ report.css é è¨­çš„ padding-top: 80pxï¼Œä½¿å…¶æ›´å° */
    padding-top: 20px !important;
  }
  
  .main-container { width: 100%; margin: 0 auto; padding: 0; }
  .logo-wrap, h1.page-title { display: none; } 

  /* --- è¦æ ¼ç”¢ç”Ÿå™¨æ¨™é¡Œæ¨£å¼ --- */
  .custom-header {
      text-align: center;
      margin-bottom: 25px;
      /* æ¨™é¡Œå¤§å°èª¿æ•´ */
      font-size: 38px;
      font-weight: bold;
      color: #333;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }

  /* ç•™é‡‘æ¨£å¼ï¼šç§»é™¤é‚Šæ¡†å’ŒèƒŒæ™¯ï¼ŒåŠ å¤§å­—é«” */
  .custom-header-gold {
      color: transparent;
      background: var(--gold-text-gradient); 
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 5s linear infinite; 
      display: inline-block;
      line-height: 1.2;
      /* åŠ å¤§å­—é«” */
      font-size: 38px;
      /* ç§»é™¤å·¦å³ padding å’Œé‚Šæ¡†/èƒŒæ™¯ */
      padding: 5px 0;
      border: none; /* ç§»é™¤é‚Šæ¡† */
      border-radius: 0; 
      background-color: transparent; /* ç§»é™¤èƒŒæ™¯ */
  }
  /* --- è¦æ ¼ç”¢ç”Ÿå™¨æ¨™é¡Œæ¨£å¼ çµæŸ --- */


  .info-grid-custom {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px; 
      margin-bottom: 25px; 
  }

  .info-item-custom {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #ddd;
      padding-bottom: 2px;
      height: 34px; 
  }

  .info-item-custom .label {
      background-color: var(--label-bg, #f0ebde);
      color: #333;
      font-weight: 700;
      font-size: 14px;
      padding: 3px 10px;
      border-radius: 4px;
      width: 85px; 
      text-align: center;
      margin-right: 8px;
      flex-shrink: 0;
      border: 1px solid var(--border-color, #e0d8c8);
  }
  
  .info-content-wrap {
      flex-grow: 1;
      display: flex;
      align-items: center;
      gap: 8px;
  }

  .warning {
      color: #ef4444; 
      font-size: 13px;
      margin-left: 93px; 
      margin-top: 5px; 
      padding-left: 35px; 
      margin-bottom: -5px; 
  }

  .input-line-custom {
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 4px;
      outline: none;
      font-size: 14px;
      font-family: 'Noto Sans TC', sans-serif;
      width: 100%;
      padding: 4px 8px;
      color: #000;
      transition: all 0.2s ease;
  }
  .input-line-custom:focus {
      border-color: var(--gold-dark);
      box-shadow: 0 0 0 3px rgba(179, 135, 40, 0.1);
  }
  
  .custom-input-wrapper {
    display: none;
    width: 100%;
    align-items: center;
    gap: 5px;
  }

  .custom-input-wrapper input {
    flex-grow: 1;
    width: auto !important; 
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 14px;
  }
  
  .reset-btn {
    width: 24px;
    height: 24px;
    line-height: 1;
    font-size: 14px;
    flex-shrink: 0;
  }
  
  .page-container {
      width: 100%;
      display: flex;
      justify-content: center;
      padding: 20px; 
      padding-bottom: 40px; 
      box-sizing: border-box;
  }

  .a4-paper {
      width: 210mm; 
      min-height: 297mm; 
      background: var(--bg-page);
      padding: 15mm 15mm; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      position: relative;
      margin: 0; 
  }

  .remarks-container { margin-bottom: 20px; }
  .remarks-input { min-height: 90px !important; resize: vertical; }

  .output-area {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background-color: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  #output-text {
    width: 90%; 
    min-height: 400px; 
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    line-height: 1.6;
    resize: vertical;
    display: block;
    margin: 0 auto;
  }

  .output-label {
      font-size: 14px;
      font-weight: 700;
      color: #333;
      margin-bottom: 5px;
      display: block;
  }

  .btn-row {
      display: flex;
      justify-content: center; 
      gap: 15px; 
      margin: 20px 0 20px 0; 
      flex-wrap: wrap; /* é¿å…æ‰‹æ©Ÿç‰ˆçˆ†ç‰ˆ */
  }

  @media (max-width: 768px) {
      .page-container { padding: 5px; padding-bottom: 20px !important; }
      .a4-paper { width: 100%; min-height: auto; padding: 15px; box-shadow: none; margin: 0; }
      
      #output-text { width: 90% !important; margin: 0 auto !important; }

      .warning {
          margin-left: 93px !important; 
          margin-top: 5px; 
          padding-left: 35px !important; 
          margin-bottom: -5px;
      }
      
      .info-item-custom {
          display: flex !important;
          flex-direction: row !important; 
          align-items: center !important;
          height: auto; 
          padding-bottom: 5px;
          border-bottom: 1px solid #ddd;
      }

      .info-item-custom .label {
          width: 85px !important; 
          margin-right: 8px !important;
          margin-bottom: 0px !important;
          flex-shrink: 0 !important;
          text-align: center; 
      }
      
      .info-content-wrap { width: auto !important; flex-grow: 1 !important; }
      .btn-row { flex-direction: column; align-items: stretch; }
  }

</style>
</head>
<body>

<div class="page-container">
    <div class="a4-paper">
        
        <h2 class="custom-header custom-header-gold">è¦æ ¼ç”¢ç”Ÿå™¨</h2>
        
        <section class="info-grid-custom">
            
            <div class="info-item-custom">
                <span class="label">æ–™è™Ÿ</span>
                <div class="info-content-wrap">
                    <input type="text" id="partNo" class="input-line-custom" placeholder="(é¸å¡«)" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase();" />
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ¿æ</span>
                    <div class="info-content-wrap">
                        <select id="material" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option selected>FR-4</option>
                            <option>FR-1</option>
                            <option>é‹åŸºæ¿</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="material_custom_div" class="custom-input-wrapper">
                            <input type="text" id="material_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ¿æ" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('material')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="materialWarning" class="warning" style="display:none;">
                    FR-1 äº¤æœŸè¼ƒé•·ï¼Œå»ºè­°ä»¥ FR-4 è£½ä½œ
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">å±¤åˆ¥</span>
                    <div class="info-content-wrap">
                        <select id="layers" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>å–®é¢æ¿</option>
                            <option selected>é›™é¢æ¿</option>
                            <option>å››å±¤æ¿</option>
                            <option>å…­å±¤æ¿</option>
                            <option>å…«å±¤æ¿</option>
                            <option>åå±¤æ¿</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="layers_custom_div" class="custom-input-wrapper">
                            <input type="text" id="layers_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥å±¤åˆ¥" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('layers')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ¿åš</span>
                    <div class="info-content-wrap">
                        <select id="thickness" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option value="0.4 mm">0.4 mm</option>
                            <option value="0.6 mm">0.6 mm</option>
                            <option value="0.8 mm">0.8 mm</option>
                            <option value="1.0 mm">1.0 mm</option>
                            <option value="1.2 mm">1.2 mm</option>
                            <option value="1.6 mm" selected>1.6 mm</option>
                            <option value="2.0 mm">2.0 mm</option>
                            <option value="2.4 mm">2.4 mm</option>
                            <option value="3.0 mm">3.0 mm</option>
                            <option value="3.2 mm">3.2 mm</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="thickness_custom_div" class="custom-input-wrapper">
                            <input type="text" id="thickness_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ¿åš" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('thickness')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="thicknessWarning" class="warning" style="display:none;">
                    æ¿åš 0.4 mm å¤ªè–„ï¼Œç„¡æ³•é€²è¡Œ V-Cutã€‚è‹¥éœ€æ‹¼æ¿ï¼Œå»ºè­°æ¡ç”¨éƒµç¥¨å­”è¨­è¨ˆã€‚
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">å…§å±¤éŠ…åš</span>
                    <div class="info-content-wrap">
                        <select id="innerCu" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>0.5oz</option>
                            <option>1oz</option>
                            <option>2oz</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="innerCu_custom_div" class="custom-input-wrapper">
                            <input type="text" id="innerCu_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥å…§å±¤éŠ…åš" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('innerCu')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="innerCuWarning" class="warning" style="display:none;">
                    å–®é¢æ¿ã€é›™é¢æ¿ä¸æ”¯æ´å…§å±¤éŠ…åš
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">å¤–å±¤éŠ…åš</span>
                    <div class="info-content-wrap">
                        <select id="outerCu" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option selected>1oz</option>
                            <option>2oz</option>
                            <option>3oz</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="outerCu_custom_div" class="custom-input-wrapper">
                            <input type="text" id="outerCu_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥å¤–å±¤éŠ…åš" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('outerCu')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">é˜²ç„Šé¡è‰²</span>
                    <div class="info-content-wrap">
                        <select id="solderMask" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option value="ç¶ è‰²" selected>ğŸŸ¢ ç¶ è‰²</option>
                            <option value="è—è‰²">ğŸ”µ è—è‰²</option>
                            <option value="é»‘è‰²">âš« é»‘è‰²</option>
                            <option value="ç™½è‰²">âšª ç™½è‰²</option>
                            <option value="ç´…è‰²">ğŸ”´ ç´…è‰²</option>
                            <option value="é»ƒè‰²">ğŸŸ¡ é»ƒè‰²</option>
                            <option value="ç„¡"> ç„¡</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="solderMask_custom_div" class="custom-input-wrapper">
                            <input type="text" id="solderMask_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥é˜²ç„Šé¡è‰²" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('solderMask')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ–‡å­—é¡è‰²</span>
                    <div class="info-content-wrap">
                        <select id="legendColor" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option value="ç™½å­—" selected>âšª ç™½å­—</option>
                            <option value="é»‘å­—">âš« é»‘å­—</option>
                            <option value="ç„¡æ–‡å­—">ç„¡æ–‡å­—</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="legendColor_custom_div" class="custom-input-wrapper">
                            <input type="text" id="legendColor_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ–‡å­—é¡è‰²" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('legendColor')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">è¡¨é¢è™•ç†</span>
                    <div class="info-content-wrap">
                        <select id="finish" class="input-line-custom" onchange="onSelectChange(this)">
                            <option value="-">-</option>
                            <option value="æœ‰é‰›å™´éŒ«">æœ‰é‰›å™´éŒ«</option>
                            <option value="ç„¡é‰›å™´éŒ«" selected>ç„¡é‰›å™´éŒ«</option>
                            <option value="åŒ–é‡‘ 1u">åŒ–é‡‘ 1u"</option>
                            <option value="åŒ–é‡‘ 2u">åŒ–é‡‘ 2u"</option>
                            <option value="åŒ–é‡‘ 3u">åŒ–é‡‘ 3u"</option>
                            <option value="ç¡¬é‡‘ 3u">ç¡¬é‡‘ 3u"</option>
                            <option value="ç¡¬é‡‘ 5u">ç¡¬é‡‘ 5u"</option>
                            <option value="OSP">OSP</option>
                            <option value="è£¸éŠ…">è£¸éŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="finish_custom_div" class="custom-input-wrapper">
                            <input type="text" id="finish_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥è¡¨é¢è™•ç†" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('finish')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="finishWarning" class="warning" style="display:none;">
                    å…­å±¤æ¿ä»¥ä¸Šï¼Œçµ±ä¸€è£½åšåŒ–é‡‘ 2u è¡¨é¢è™•ç†
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">é‡‘(éŒ«)æ‰‹æŒ‡</span>
                    <div class="info-content-wrap">
                        <select id="goldFinger" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>æ–œé‚Š30Â°</option>
                            <option>æ–œé‚Š45Â°</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="goldFinger_custom_div" class="custom-input-wrapper">
                            <input type="text" id="goldFinger_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥é‡‘(éŒ«)æ‰‹æŒ‡" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('goldFinger')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">æ•¸é‡(å‡ºè²¨ç‰‡)</span>
                    <div class="info-content-wrap">
                        <select id="qty" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option selected>5</option>
                            <option>10</option>
                            <option>15</option>
                            <option>20</option>
                            <option>25</option>
                            <option>30</option>
                            <option>50</option>
                            <option>75</option>
                            <option>100</option>
                            <option>125</option>
                            <option>150</option>
                            <option>200</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="qty_custom_div" class="custom-input-wrapper">
                            <input type="text" id="qty_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥æ•¸é‡" class="input-line-custom" oninput="formatNumber(this)" />
                            <button type="button" class="reset-btn" onclick="resetSelect('qty')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">ç‰¹æ®Šè£½ç¨‹#1</span>
                    <div class="info-content-wrap">
                        <select id="special1" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>åŠå­”</option>
                            <option>å¡å­”</option>
                            <option>æ¨¹è„‚å¡å­”</option>
                            <option>BGA</option>
                            <option>å´é‚ŠééŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="special1_custom_div" class="custom-input-wrapper">
                            <input type="text" id="special1_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥ç‰¹æ®Šè£½ç¨‹" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('special1')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
                <div id="special1Warning" class="warning" style="display:none;">
                    å…­å±¤æ¿ä»¥ä¸Šï¼Œçµ±ä¸€è£½ä½œæ¨¹è„‚å¡å­”è£½ç¨‹
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">ç‰¹æ®Šè£½ç¨‹#2</span>
                    <div class="info-content-wrap">
                        <select id="special2" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>åŠå­”</option>
                            <option>å¡å­”</option>
                            <option>æ¨¹è„‚å¡å­”</option>
                            <option>BGA</option>
                            <option>å´é‚ŠééŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="special2_custom_div" class="custom-input-wrapper">
                            <input type="text" id="special2_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥ç‰¹æ®Šè£½ç¨‹" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('special2')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="field-group-wrap">
                <div class="info-item-custom">
                    <span class="label">ç‰¹æ®Šè£½ç¨‹#3</span>
                    <div class="info-content-wrap">
                        <select id="special3" class="input-line-custom" onchange="onSelectChange(this)">
                            <option>-</option>
                            <option>åŠå­”</option>
                            <option>å¡å­”</option>
                            <option>æ¨¹è„‚å¡å­”</option>
                            <option>BGA</option>
                            <option>å´é‚ŠééŠ…</option>
                            <option value="custom">è‡ªè¡Œè¼¸å…¥</option>
                        </select>
                        <div id="special3_custom_div" class="custom-input-wrapper">
                            <input type="text" id="special3_custom" placeholder="è«‹è‡ªè¡Œè¼¸å…¥ç‰¹æ®Šè£½ç¨‹" class="input-line-custom" />
                            <button type="button" class="reset-btn" onclick="resetSelect('special3')" title="åˆ‡æ›å›é¸å–®">Ã—</button>
                        </div>
                    </div>
                </div>
            </div>
            
        </section>

        <div id="unified-remarks-container" data-hide-signature="true"></div>
        
        <div class="btn-row">
            <button type="button" class="btn-glass-base btn-glass-gold" onclick="generateAndCopyText()">ä¸€éµç”Ÿæˆ+è¤‡è£½</button>
            <button type="button" class="btn-glass-base btn-glass-blue" onclick="generateTextAndSave()">ç”Ÿæˆæ–‡å­—</button>
            <button type="button" class="btn-glass-base btn-glass-gray" onclick="copyText()">è¤‡è£½æ–‡å­—</button>
            <button type="button" class="btn-glass-base btn-glass-red" onclick="resetAllFields()">æ¸…ç©ºé‡å¡«</button>
        </div>

        <div class="output-area">
            <span class="output-label">è¦æ ¼è¨Šæ¯</span>
            <textarea id="output-text" placeholder="é»æ“Šã€Œç”Ÿæˆæ–‡å­—ã€æŒ‰éˆ•å¾Œï¼Œæœƒåœ¨æ­¤è™•é¡¯ç¤ºå®Œæ•´çš„ PCB è¦æ ¼è³‡è¨Š"></textarea>
        </div>

    </div>
</div>

<script src="./js system/template.js"></script>

<script>
  function formatNumber(input) {
    var value = input.value.replace(/\D/g, "");
    if (value) {
      input.value = Number(value).toLocaleString("en-US");
    } else {
      input.value = "";
    }
  }

  function checkCustom(selectEl) {
    if (selectEl.value === 'custom') {
      var customDivId = selectEl.id + '_custom_div';
      var customDiv = document.getElementById(customDivId);
      var customInput = document.getElementById(selectEl.id + '_custom');
      if (customDiv) {
        selectEl.style.display = 'none';
        customDiv.style.display = 'flex';
        // è‡ªå‹•èšç„¦
        if(customInput) {
            setTimeout(() => customInput.focus(), 50);
        }
      }
      return true;
    }
    return false;
  }

  function resetSelect(selectId) {
    var selectEl = document.getElementById(selectId);
    var customDiv = document.getElementById(selectId + '_custom_div');
    var customInput = document.getElementById(selectId + '_custom');
    if (selectEl && customDiv) {
      customDiv.style.display = 'none';
      customInput.value = ''; 
      selectEl.style.display = 'block';
      selectEl.value = '-';
      updateStates();
    }
  }

  function onSelectChange(el) {
    checkCustom(el);
    updateStates();
  }
  
  // [ä¿®æ”¹] ç”Ÿæˆæ–‡å­— + è¤‡è£½ + å­˜æª” (è‹¥æœ‰æ–™è™Ÿ)
  function generateAndCopyText() {
    generateText();
    // åªè¦æœ‰æœ›æœ‰å¡«æ–™è™Ÿå°±å„²å­˜ç´€éŒ„ï¼Œä¸éœ€å®¢æˆ¶åç¨±
    if (getValue("partNo")) {
        if(typeof saveCurrentReportToHistory === 'function') saveCurrentReportToHistory();
    }
    copyText(true); // å‚³å…¥ true é¿å… copyText å†æ¬¡é‡è¤‡å„²å­˜
  }

  // [æ–°å¢] å°ˆé–€çµ¦ã€Œç”Ÿæˆæ–‡å­—ã€æŒ‰éˆ•ç”¨çš„å‡½å¼ï¼Œä¹Ÿæœƒè§¸ç™¼å­˜æª”
  function generateTextAndSave() {
    generateText();
    if (getValue("partNo")) {
        if(typeof saveCurrentReportToHistory === 'function') saveCurrentCurrentReportToHistory();
        window.showToast("è¦æ ¼å·²ç”Ÿæˆä¸¦å„²å­˜");
    }
  }

  // [ä¿®æ”¹] æ¸…ç©ºé‡å¡«åŠŸèƒ½
  function resetAllFields() {
    if(!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ¬„ä½å—ï¼Ÿ')) return;
    
    // é‡ç½®æ‰€æœ‰ä¸‹æ‹‰é¸å–®èˆ‡è‡ªè¨‚è¼¸å…¥
    document.querySelectorAll('select').forEach(sel => {
        resetSelect(sel.id);
        sel.value = (sel.id === 'qty') ? '5' : '-'; 
        if(sel.id === 'material') sel.value = 'FR-4';
        if(sel.id === 'layers') sel.value = 'é›™é¢æ¿';
        if(sel.id === 'thickness') sel.value = '1.6 mm';
        if(sel.id === 'outerCu') sel.value = '1oz';
        if(sel.id === 'solderMask') sel.value = 'ç¶ è‰²';
        if(sel.id === 'legendColor') sel.value = 'ç™½å­—';
        if(sel.id === 'finish') sel.value = 'ç„¡é‰›å™´éŒ«';
    });

    // æ¸…ç©ºå…¶ä»–è¼¸å…¥æ¡† (åŒ…å«æ–™è™Ÿ)
    document.querySelectorAll('input[type="text"]').forEach(inp => inp.value = "");
    document.querySelector('.remarks-input').value = "";
    document.getElementById("output-text").value = "";
    
    updateStates();
    window.showToast("æ¬„ä½å·²æ¸…ç©º");
  }

  document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.custom-input-wrapper input').forEach(input => {
          input.addEventListener('blur', function() {
              if (this.value.trim() === '') {
                  const selectId = this.id.replace('_custom', '');
                  resetSelect(selectId);
              }
          });
      });
      updateStates();
  });

  const SPEC_RULES = {
      locks: [
          { rule: (material, layers) => ['å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            target: 'finish', 
            action: (sel) => { sel.value = 'åŒ–é‡‘ 2u'; sel.disabled = true; document.getElementById('finishWarning').style.display = 'block'; } },
          
          { rule: (material, layers) => ['å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            target: 'special1', 
            action: (sel) => { sel.value = 'æ¨¹è„‚å¡å­”'; sel.disabled = true; document.getElementById('special1Warning').style.display = 'block'; } },
      ],
      restrictions: [
          { rule: (material) => material === 'FR-1', 
            targets: [
              { id: 'layers', disable_values: ['é›™é¢æ¿', 'å››å±¤æ¿', 'å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'], default_value: 'å–®é¢æ¿', warning: 'materialWarning' },
              { id: 'thickness', disable_values: ['0.4 mm', '0.6 mm', '0.8 mm', '1.0 mm', '1.2 mm', '2.0 mm', '2.4 mm', '3.0 mm', '3.2 mm'], default_value: '1.6 mm' },
              { id: 'outerCu', disable_values: ['2oz', '3oz'], default_value: '1oz' },
              { id: 'goldFinger', disable_all: true, default_value: '-' },
              { id: 'special1', disable_all: true, default_value: '-' },
              { id: 'special2', disable_all: true, default_value: '-' },
              { id: 'special3', disable_all: true, default_value: '-' },
              { id: 'innerCu', disable_all: true, default_value: '-', warning: 'innerCuWarning' }
            ]
          },
          { rule: (material, layers) => ['å–®é¢æ¿', 'é›™é¢æ¿'].includes(layers), 
            targets: [
              { id: 'innerCu', disable_all: true, default_value: '-', warning: 'innerCuWarning' }
            ]
          },
          { rule: (material, layers) => ['å››å±¤æ¿', 'å…­å±¤æ¿', 'å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            targets: [
              { id: 'thickness', disable_values: ['0.4 mm'], warning: 'thicknessWarning' }
            ]
          },
          { rule: (material, layers) => ['å…«å±¤æ¿', 'åå±¤æ¿'].includes(layers), 
            targets: [
              { id: 'thickness', disable_values: ['0.4 mm', '0.6 mm'], warning: 'thicknessWarning' }
            ]
          }
      ],
      defaults: [
          { rule: (material, layers) => layers !== 'å–®é¢æ¿' && layers !== 'é›™é¢æ¿' && layers !== '-' && layers !== 'custom', 
            target: 'innerCu', 
            action: (sel, currentVal) => { if (currentVal === '-' || currentVal === '') sel.value = '0.5oz'; } }
      ]
  };

  function updateStates() {
    const currentValues = {
      material: getValue("material"),
      layers: getValue("layers"),
      thickness: getValue("thickness"),
      innerCu: getValue("innerCu"),
      finish: getValue("finish"),
      special1: getValue("special1")
    };
    
    document.querySelectorAll('select').forEach(sel => {
        if (sel.id.startsWith('special') || sel.id === 'layers' || sel.id === 'thickness' || sel.id === 'innerCu' || sel.id === 'finish' || sel.id === 'outerCu' || sel.id === 'goldFinger') {
            sel.disabled = false;
            Array.from(sel.options).forEach(opt => opt.disabled = false);
        }
    });
    document.querySelectorAll('.warning').forEach(warn => warn.style.display = 'none');

    SPEC_RULES.restrictions.forEach(restriction => {
        if (restriction.rule(currentValues.material, currentValues.layers)) {
            restriction.targets.forEach(target => {
                const sel = document.getElementById(target.id);
                if (!sel || checkCustom(sel)) return;

                if (target.warning) {
                    const warnEl = document.getElementById(target.warning);
                    if (warnEl) warnEl.style.display = 'block';
                }

                if (target.disable_all) {
                    sel.disabled = true;
                } else if (target.disable_values) {
                    target.disable_values.forEach(val => {
                        const opt = sel.querySelector(`option[value="${val}"]`);
                        if (opt) opt.disabled = true;
                    });
                }

                const currentOpt = sel.options[sel.selectedIndex];
                if (currentOpt && currentOpt.disabled && sel.value !== 'custom') {
                    sel.value = target.default_value;
                }
            });
        }
    });
    
    const thickness = getValue("thickness");
    if (thickness === "0.4 mm" && currentValues.material !== "FR-1") {
        const thicknessOpt = document.getElementById("thickness").options[document.getElementById("thickness").selectedIndex];
        if (thicknessOpt && !thicknessOpt.disabled) {
            document.getElementById('thicknessWarning').style.display = 'block';
        }
    }

    SPEC_RULES.locks.forEach(lock => {
        const sel = document.getElementById(lock.target);
        if (lock.rule(currentValues.material, currentValues.layers) && !checkCustom(sel)) {
            lock.action(sel);
        }
    });

    SPEC_RULES.defaults.forEach(defaultRule => {
        const sel = document.getElementById(defaultRule.target);
        if (defaultRule.rule(currentValues.material, currentValues.layers) && !checkCustom(sel)) {
            defaultRule.action(sel, getValue(defaultRule.target));
        }
    });
  }

  function trim(str) {
    return str.replace(/^\s+|\s+$/g, "");
  }

  function getValue(id) {
    var el = document.getElementById(id);
    if (!el) return "";
    
    if (el.tagName === 'SELECT' && el.value === 'custom') {
      var customInput = document.getElementById(id + '_custom');
      if (customInput) {
        var val = trim(customInput.value);
        return val || ""; 
      }
    } else if (id === 'specialAmount') {
      // è¨‚å–®é‡‘é¡å·²ç§»é™¤
      return "";
    }
    
    var v = trim(el.value);
    // ç§»é™¤ä¸å¿…è¦çš„æç¤ºå­— (é›–ç„¶ placeholder æ‡‰è©²ä¸æœƒè¢«æŠ“åˆ°)
    if (v === '(é¸å¡«)') return ""; 
    
    return v || "";
  }
  
  function generateText() {
    var partNo = getValue("partNo");
    var material = getValue("material");
    var layers = getValue("layers");
    var thickness = getValue("thickness");
    var innerCu = getValue("innerCu");
    var outerCu = getValue("outerCu");
    var solderMask = getValue("solderMask");
    var legendColor = getValue("legendColor");
    var finish = getValue("finish");
    var goldFinger = getValue("goldFinger");
    var qty = getValue("qty");
    
    var specials = [];
    var specialsIds = ["special1", "special2", "special3"];
    for (var i = 0; i < specialsIds.length; i++) {
      var v = getValue(specialsIds[i]);
      if (v && v !== "-" && v !== "è«‹é¸æ“‡") specials.push(v);
    }
    
    var remarksEl = document.querySelector('.remarks-input');
    var remark = remarksEl ? trim(remarksEl.value) : "";
    
    var lines = [
      "æ–™è™Ÿï¼š" + (partNo || "-"),
      "æ¿æï¼š" + (material || "-"),
      "å±¤åˆ¥ï¼š" + (layers || "-"),
      "æ¿åšï¼š" + (thickness || "-")
    ];

    if (layers !== "å–®é¢æ¿" && layers !== "é›™é¢æ¿" && layers !== "" && layers !== "-") {
      lines.push("å…§å±¤éŠ…åšï¼š" + (innerCu || "-"));
    }

    lines.push(
      "å¤–å±¤éŠ…åšï¼š" + (outerCu || "-"),
      "é˜²ç„Šé¡è‰²ï¼š" + (solderMask || "-"),
      "æ–‡å­—é¡è‰²ï¼š" + (legendColor || "-"),
      "è¡¨é¢è™•ç†ï¼š" + (finish || "-")
    );

    if (goldFinger && goldFinger !== "-" && goldFinger !== "è«‹é¸æ“‡") {
      lines.push("é‡‘(éŒ«)æ‰‹æŒ‡ï¼š" + goldFinger);
    }

    lines.push("æ•¸é‡(å‡ºè²¨ç‰‡)ï¼š" + (qty || "-"));

    if (specials.length > 0) {
      var uniqueSpecials = Array.from(new Set(specials));
      lines.push("ç‰¹æ®Šè£½ç¨‹ï¼š" + uniqueSpecials.join("ã€"));
    }
    
    var msg = lines.join("\n");
    
    var now = new Date();
    var timeStr = now.getFullYear() + "/" + 
                  (now.getMonth() + 1).toString().padStart(2, '0') + "/" + 
                  now.getDate().toString().padStart(2, '0') + " " + 
                  now.getHours().toString().padStart(2, '0') + ":" + 
                  now.getMinutes().toString().padStart(2, '0');
    
    msg = timeStr + "\n" + msg;

    if (remark) {
      msg += "\n\nå‚™è¨»ï¼š" + remark;
    }
    
    document.getElementById("output-text").value = msg;
  }

  async function copyText(skipSave = false) {
    var output = document.getElementById("output-text");
    
    if (!output.value) {
        generateText(); 
        if (!output.value) {
            window.showToast("è«‹å…ˆå®Œæˆè¦æ ¼è¼¸å…¥ï¼", "error");
            return;
        }
    }

    // [ä¿®æ”¹] åªæœ‰ç•¶æ–™è™Ÿå­˜åœ¨æ™‚æ‰å„²å­˜ (çœç•¥å®¢æˆ¶æª¢æŸ¥)
    if (!skipSave && getValue("partNo")) {
         if(typeof saveCurrentReportToHistory === 'function') saveCurrentReportToHistory();
    }

    output.select();
    output.setSelectionRange(0, 99999); 
    
    try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
             navigator.clipboard.writeText(output.value).then(() => {
                window.showToast("æ–‡å­—è¨Šæ¯å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
             }).catch(err => {
                fallbackCopy();
             });
        } else {
            fallbackCopy();
        }
    } catch (err) {
        fallbackCopy();
    }
  }

  function fallbackCopy() {
    try {
        document.execCommand("copy");
        window.showToast("æ–‡å­—è¨Šæ¯å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
    } catch (err) {
        window.showToast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½", "error");
    }
  }
</script>

</body>

</html>
