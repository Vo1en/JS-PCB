<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCB å‡ºè²¨æª¢é©—å ±å‘Š</title>
    <style>
        /* ================================================= */
        /* === START: ä¾†è‡ª navbar.html çš„ CSS æ¨£å¼ === */
        /* ================================================= */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&family=Roboto:wght@300;400;700&display=swap');

        :root {
            --bg-gradient: linear-gradient(135deg, #fcfaf5 0%, #f0ebde 100%);
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(194, 168, 120, 0.6);
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --gold-gradient: linear-gradient(135deg, #c2a878 0%, #e3d1a8 50%, #9e8b6b 100%);
            --gold-text-gradient: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --active-color: #c2a878;
        }

        /* å…¨åŸŸ box-sizing */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            align-items: center;
            padding: 10px 40px;
            justify-content: flex-start;
            gap: 50px;
            background-color: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--glass-border);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            z-index: 1000;
        }

        .brand-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            padding: 5px 0;
            flex-shrink: 0;
        }

        .text-logo {
            font-family: 'Roboto', sans-serif;
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: -1px;
            background: var(--gold-text-gradient);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.3));
            transition: transform 0.3s, filter 0.3s;
            animation: shine 5s linear infinite;
            white-space: nowrap;
        }

        .brand-logo:hover .text-logo {
            transform: scale(1.05);
            filter: drop-shadow(0 0 5px rgba(194, 168, 120, 0.8))
                    drop-shadow(0 2px 3px rgba(0, 0, 0, 0.3));
        }

        .nav-links {
            display: flex;
            gap: 25px;
            flex-wrap: nowrap;
        }

        .nav-item {
            text-decoration: none;
            color: var(--text-main);
            font-size: 1rem;
            font-weight: 500;
            padding: 5px 0;
            position: relative;
            transition: color 0.3s;
            white-space: nowrap;
        }

        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--active-color);
            transition: width 0.3s ease-out, left 0.3s ease-out;
            border-radius: 2px;
        }

        .nav-item:hover {
            color: var(--active-color);
        }

        .nav-item.current {
            color: var(--active-color);
        }

        .nav-item:hover::after,
        .nav-item.current::after {
            width: 100%;
            left: 0;
        }

        @keyframes shine {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                align-items: center;
                padding: 10px 10px;
                gap: 5px;
            }
            .text-logo {
                font-size: 1.8rem;
                letter-spacing: -0.5px;
            }
            .nav-links {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px 15px;
            }
            .nav-item {
                font-size: 0.9rem;
            }
        }
        /* ================================================= */
        /* === END: ä¾†è‡ª navbar.html çš„ CSS æ¨£å¼ === */
        /* ================================================= */

        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            color: #333;
            width: 100%;
            padding-top: 80px; /* é›»è…¦ç‰ˆä¸Šæ–¹ç•™ç™½ */
        }

        .page-container {
            width: 210mm; /* A4 width standard */
            background-color: white;
            margin: 0 auto 20px auto; 
            padding: 15mm; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            box-sizing: border-box;
            position: relative;
        }
        
        /* Header Section */
        header {
            border-bottom: 2px solid #000;
            padding-bottom: 8px; 
            margin-bottom: 15px; 
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .company-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header-right {
             display: flex;
             flex-direction: column;
             align-items: flex-end;
             font-size: 14px;
        }
        
        .company-name {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .company-details-line {
            font-size: 12px; 
            color: #666;
            margin-top: 2px;
        }

        .report-title {
            font-size: 28px;
            text-align: center;
            font-weight: bold;
            margin: 15px 0; 
            letter-spacing: 2px;
        }

        /* Table Styles */
        /* ä¿®æ­£ #2: åŠ å…¥ table-layout: fixedï¼Œé˜²æ­¢åˆ‡æ›è¼¸å…¥æ¡†æ™‚æ¬„ä½è·³å‹• */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px; 
            font-size: 13px;
            table-layout: fixed; /* å›ºå®šä½ˆå±€ */
        }

        th, td {
            border: 1px solid #000;
            padding: 6px; 
            text-align: left;
            color: black;
            overflow: hidden; /* é˜²æ­¢å…§å®¹æ’é–‹è¡¨æ ¼ */
        }

        /* æ˜ç¢ºå®šç¾©æ¬„ä½å¯¬åº¦ï¼Œç¢ºä¿ä¸æœƒè·‘ç‰ˆ */
        th {
            background-color: #e0f2fe; 
            font-weight: bold;
            width: 15%; /* æ¨™é¡Œæ¬„å¯¬åº¦å›ºå®š */
            white-space: nowrap;
            color: #333; 
        }

        /* å…§å®¹æ¬„ä½å¯¬åº¦ */
        td {
             width: 35%; /* å‰©é¤˜ç©ºé–“å¹³å‡åˆ†é… (100% - 15%*2) / 2 = 35% */
        }
        
        .section-header {
            background-color: #dbeafe; 
            color: #000; 
            padding: 4px 10px; 
            font-weight: bold;
            margin-top: 0px; 
            margin-bottom: 1px; 
            font-size: 15px;
            border-radius: 2px;
        }

        .center-text {
            text-align: center;
        }

        .footer-section {
            margin-top: 100px;
            display: flex;
            justify-content: space-around; 
            page-break-inside: avoid;
            page-break-before: avoid; 
        }

        .signature-box {
            width: 180px; 
            border-top: 1px solid #000;
            padding-top: 5px; 
            text-align: center;
            font-size: 14px;
            font-weight: bold;
        }
        .signature-box > div:last-child {
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .signature-box img {
            max-height: 100%; 
            max-width: 100%;
            object-fit: contain; 
        }

        #inspectionDate {
            font-size: 14px; 
            padding: 2px 4px;
            border: 1px dashed #ccc;
            background-color: #f7f7f7;
            text-align: right;
            width: 110px;
        }
        .date-container {
             margin-top: 10px;
        }

        .action-buttons {
            position: absolute;
            top: 20px; 
            right: 20px; 
            z-index: 10;
        }
        .action-buttons button {
            background: #3b82f6; 
            color: white;
            border: none;
            padding: 8px 12px; 
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            line-height: 1;
            transition: background-color 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .action-buttons button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        .action-buttons button span {
            margin-right: 5px;
        }

        .editable {
            background-color: #f7f7f7; 
            min-width: 50px;
            display: inline-block;
            padding: 2px;
            border: 1px dashed #ccc;
            box-sizing: border-box; 
        }
        .editable:focus {
            outline: none;
            border: 1px solid #34495e;
            background-color: #fff;
        }
        
        #qty-input {
            width: 80px; 
            text-align: center; 
        }
        .page-container > div:nth-child(4) + table .editable:not(#qty-input) {
            width: 95%; 
            min-width: 180px; 
        }
        
        .placeholder-text {
            color: #9e9e9e; 
        }
        
        .missing {
            border: 2px solid red !important;
            background-color: #ffeeee !important;
        }

        select {
            border: 1px dashed #ccc;
            padding: 2px;
            margin: 0;
            font-size: 13px;
            background-color: #f7f7f7; 
            color: black;
        }
        select:focus {
            outline: 1px solid #34495e;
            background-color: #fff;
        }
        
        .pnl-input-span {
            display: inline-block;
            width: 25px;
            text-align: center; 
            border: 1px dashed #ccc;
            background-color: #f7f7f7;
            padding: 2px;
            line-height: normal; 
            box-sizing: border-box;
        }
        .pnl-input-span:focus {
            outline: none;
            border: 1px solid #34495e;
            background-color: #fff;
        }

        .editable-nominal {
            display: inline-block;
            width: 50px; 
            text-align: center;
            background-color: #f7f7f7; 
            border: 1px dashed #ccc;
            box-sizing: border-box;
        }
        .editable-nominal:focus {
            outline: none;
            border: 1px solid #34495e;
            background-color: #fff;
        }
        .spec-tolerance {
             display: inline-block; 
        }
        .tolerance-display {
            display: inline-block;
            margin-left: 2px;
            white-space: nowrap; 
        }
        
        .color-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            border: 1px solid #000; 
            vertical-align: middle;
        }

        #pcb-spec-table td {
            text-align: center !important; 
        }
        
        #dim-length-input, #dim-width-input {
             text-align: center;
        }

        #inspection-data-table tbody td:first-child {
            text-align: center; 
        }
        #inspection-data-table td:nth-child(2) {
             white-space: nowrap; 
             padding: 4px 6px; 
        }
        
        /* æª¢é©—æ•¸æ“šè¡¨æ ¼çš„ç‰¹ä¾‹å¯¬åº¦ */
        #inspection-data-table th:nth-child(n+3):nth-child(-n+7),
        #inspection-data-table td:nth-child(n+3):nth-child(-n+7) {
            width: 8% !important; 
            padding-left: 2px;
            padding-right: 2px;
        }
        #inspection-data-table th:nth-child(1) {
            width: 15% !important; 
        }
        #inspection-data-table th:nth-child(2),
        #inspection-data-table td:nth-child(2) {
             width: auto; /* è¦æ ¼æ¬„ä½å¯¬åº¦è‡ªå‹• */
        }
        
        .final-decision-box {
            padding: 8px 10px !important; 
            margin-top: 25px; 
            page-break-before: avoid; 
        }
        
        .decision-qualified-active {
            color: green;
            font-weight: bold;
        }
        .decision-inactive {
            color: #999;
        }

        /* ================================================= */
        /* === æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼å„ªåŒ– (Mobile Optimization) === */
        /* ================================================= */
        @media screen and (max-width: 600px) {
            /* ä¿®æ­£ #1: èª¿æ•´ä¸Šæ–¹ç•™ç™½ç‚º 112px */
            body {
                padding-top: 112px !important; 
            }

            .page-container {
                width: 100%;
                padding: 12px;
                padding-bottom: 20px; 
                box-shadow: none;
                margin: 0 !important; 
                margin-top: 0 !important; 
            }
            
            /* Header Adjustments for Mobile */
            header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .company-info {
                align-items: center; 
                margin-bottom: 10px;
            }
            .header-right {
                align-items: center;
                width: 100%;
            }
            #inspectionDate {
                width: 150px !important;
                min-width: 140px;
                text-align: center;
            }

            .action-buttons {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                padding: 10px;
                background-color: white;
                border-top: 1px solid #eee;
                box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
                z-index: 100;
                width: auto;
                margin: 0;
                text-align: center;
            }
            .action-buttons button {
                 width: 100%;
                 padding: 12px;
                 font-size: 16px;
                 margin-bottom: 0;
                 justify-content: center; 
            }
            
            .company-name {
                font-size: 22px;
            }
            .report-title {
                font-size: 24px;
            }

            /* æ‰‹æ©Ÿç‰ˆï¼šå–æ¶ˆ table å›ºå®šä½ˆå±€ï¼Œæ”¹ç”¨ block å †ç–Šé¡¯ç¤º */
            table:not(#inspection-data-table) {
                display: block;
                width: 100%;
                border: none;
                table-layout: auto !important; /* å–æ¶ˆå›ºå®šå¯¬åº¦ */
            }
            
            table:not(#inspection-data-table) tbody {
                display: block;
            }

            table:not(#inspection-data-table) tr {
                display: flex;
                flex-direction: column;
                margin-bottom: 15px;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                background: white;
                box-shadow: 0 1px 3px rgba(0,0,0,0.05);
                overflow: hidden;
            }

            table:not(#inspection-data-table) tr[style*="display: none"] {
                display: none !important;
            }

            table:not(#inspection-data-table) th {
                display: block;
                width: 100%;
                background-color: #f8f9fa;
                border: none;
                border-bottom: 1px solid #eee;
                padding: 8px 12px;
                font-size: 14px;
                color: #2c3e50;
                text-align: left;
            }
            
            table:not(#inspection-data-table) td {
                display: block;
                width: 100%;
                border: none;
                padding: 10px 12px;
                box-sizing: border-box;
            }

            .page-container select,
            .page-container input[type="text"],
            .page-container input[type="number"],
            .other-input-field {
                width: 100% !important;
                max-width: 100% !important;
                height: 40px; 
                font-size: 16px; 
                margin-top: 5px;
                box-sizing: border-box;
            }
            
            /* é€šç”¨æ¨£å¼ï¼šé€™è£¡è®“ä¸€èˆ¬è¼¸å…¥æ¡†åœ¨æ‰‹æ©Ÿç‰ˆè®Šå¯¬ */
            .page-container .editable,
            .page-container .editable-nominal {
                width: 100% !important;
                min-width: 60px !important;
                min-height: 36px; 
                line-height: 28px; 
                display: block;
                margin-top: 5px;
                padding: 4px; 
            }
            
            /* ä¿®æ­£ #1: é‡å°ã€Œæª¢é©—æ•¸æ“šè¡¨æ ¼ã€çš„ç‰¹æ®Šè™•ç† */
            /* å¼·åˆ¶å°‡è¼¸å…¥æ¡†æ”¹å› inline-block ä¸¦é™åˆ¶å¯¬åº¦ï¼Œè§£æ±ºè·‘ç‰ˆå•é¡Œ */
            #inspection-data-table .editable-nominal {
                display: inline-block !important; /* å¼·åˆ¶ä¸¦æ’ */
                width: 50px !important; /* é™åˆ¶å¯¬åº¦ */
                min-width: 50px !important;
                margin-top: 0 !important;
                min-height: auto !important;
                line-height: normal !important;
            }
            
            #inspection-data-table .tolerance-display {
                white-space: nowrap !important;
            }

            /* é‡å°è¦æ ¼æ¬„ä½ (ç¬¬äºŒæ¬„) ä½¿ç”¨ Flex æ’åˆ—ï¼Œç¢ºä¿æ°´å¹³ç½®ä¸­ä¸æ›è¡Œ */
            #inspection-data-table td:nth-child(2) {
                display: flex !important;
                flex-direction: row !important;
                align-items: center !important;
                justify-content: center !important;
                white-space: nowrap !important;
                border: 1px solid #000 !important;
                padding: 4px !important;
                min-width: 150px; 
            }

            #qty-input {
                width: 100% !important; 
                text-align: left !important;
            }

            #pcb-spec-table tr:nth-child(3),
            #pcb-spec-table tr:nth-child(4) {
                 display: flex; 
            }
            
            .pnl-input-span {
                width: 60px !important; 
                display: inline-block !important;
                height: 36px; 
                vertical-align: middle;
                margin: 0 5px;
            }

            #inspection-data-table-wrapper {
                overflow-x: auto;
                width: 100%;
                border: 1px solid #ddd;
                border-radius: 6px;
                -webkit-overflow-scrolling: touch; 
                margin-bottom: 20px;
            }
            #inspection-data-table {
                min-width: 800px; 
                margin-bottom: 0;
            }
            
            #inspection-data-table .editable {
                min-width: 40px !important;
                width: 100% !important;
                text-align: center;
                padding: 10px 0; 
                min-height: 30px;
            }

            .footer-section {
                flex-direction: column;
                gap: 20px;
                margin-top: 40px;
                align-items: center;
            }
            .signature-box {
                width: 80%;
                margin: 0 auto;
            }
        }

        /* PRINT STYLES */
        @media print {
            body {
                background-color: white;
                padding: 0 !important; 
                font-size: 12pt; 
            }
            .page-container {
                box-shadow: none;
                margin: 0;
                width: 100%;
                padding: 5mm 10mm; 
                padding-bottom: 2mm; 
                margin-top: 0 !important;
            }
            .action-buttons, .navbar {
                display: none;
            }
            
            .section-header, th {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            .section-header {
                background-color: #dbeafe !important; 
                color: #000 !important; 
                border-bottom: 1px solid #000;
                border-top: 1px solid #000;
            }
            th {
                background-color: #e0f2fe !important;
                color: #333 !important; 
            }
            
            select {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-image: none;
                border: none;
                padding: 0;
            }
            .editable, .editable-nominal, select, input[type="number"], input[type="text"], .pnl-input-span {
                color: black !important;
                background-color: transparent;
                border: none;
                padding: 0;
            }
            #inspectionDate {
                 border: none !important;
                 background-color: transparent !important;
                 -webkit-appearance: none;
                 -moz-appearance: none;
                 appearance: none;
            }
            
            .placeholder-text {
                color: transparent !important;
                background-color: transparent !important;
            }
            .pnl-input-span.placeholder-text {
                color: transparent !important;
            }

            .footer-section {
                margin-top: 40px !important; 
            }
            .final-decision-box {
                margin-top: 0px !important; 
            }
            
            .hide-on-print {
                display: none;
            }
            
            #inspection-data-table-wrapper {
                overflow-x: visible;
            }
            
            /* åˆ—å°æ™‚æ¢å¾©é è¨­è¡¨æ ¼é¡¯ç¤º */
            #inspection-data-table td:nth-child(2) {
                display: table-cell !important;
                white-space: nowrap !important;
                border: 1px solid #000 !important;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="brand-logo">
            <span class="text-logo">JS PCB</span>
        </a>

        <div class="nav-links">
            <a href="index.html" class="nav-item">é¦–é </a>
            <a href="PCB Order Info Generator.html" class="nav-item">PCBè¦æ ¼ç”¢ç”Ÿå™¨</a>
            <a href="PCB Inspection Report.html" class="nav-item current">å‡ºè²¨æª¢é©—å ±å‘Š</a>
            <a href="PCB Test Report.html" class="nav-item">é›»æ€§æ¸¬è©¦å ±å‘Š</a>
        </div>
    </nav>
    <div class="page-container" contenteditable="false">
        
        <div class="action-buttons">
            <button onclick="prepareForPrint()" title="åˆ—å° / å­˜ç‚ºPDF">
                <span>ğŸ–¨ï¸</span> åˆ—å° / PDF
            </button>
        </div>
        
        <header contenteditable="false">
            <div class="company-info">
                <div class="company-name" contenteditable="true">é§¿é‘«å¯¦æ¥­æœ‰é™å…¬å¸</div>
                <div class="company-details-line" contenteditable="true">æ–°åŒ—å¸‚äº”è‚¡å€æˆæ³°è·¯äºŒæ®µ197å··31è™Ÿ</div>
                <div class="company-details-line" contenteditable="true">TEL: 02-2291-1252 #26</div>
            </div>
             <div class="header-right">
                <div class="date-container">
                    <strong>æª¢é©—æ—¥æœŸ:</strong> 
                    <input type="date" id="inspectionDate" onchange="this.value.trim() ? this.style.color='black' : this.style.color='grey'" style="color: black;">
                </div>
            </div>
        </header>

        <div class="report-title">PCB å‡ºè²¨æª¢é©—å ±å‘Š</div>

        <div class="section-header">1. åŸºæœ¬è³‡è¨Š</div>
        <table>
            <tr>
                <th>å®¢æˆ¶åç¨±</th>
                <td colspan="3"><span class="editable placeholder-text" contenteditable="true" id="customer-name" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span></td>
            </tr>
            <tr>
                <th>å®¢æˆ¶æ–™è™Ÿ</th>
                <td colspan="3"><span class="editable placeholder-text" contenteditable="true" id="customer-part" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span></td>
            </tr>
            <tr>
                <th>å“å</th>
                <td colspan="3">PCB</td>
            </tr>
            <tr>
                <th>å‡ºè²¨æ•¸é‡</th>
                <td style="white-space: nowrap;"> 
                    <span class="editable placeholder-text" contenteditable="true" id="qty-input" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)" >è«‹è¼¸å…¥</span>
                    <select style="width: 60px;">
                        <option value="PCS" selected>PCS</option>
                        <option value="PNL">PNL</option>
                    </select>
                </td>
                <th>é€±æœŸ</th>
                <td>
                    <div id="date-code-container" style="display: flex; align-items: center; gap: 5px;">
                        <select id="date-code-select" onchange="toggleDateCodeInput(this)"> 
                            <option value="none" selected>ç„¡é€±æœŸ</option>
                            <option value="has">æœ‰é€±æœŸ</option>
                        </select>
                        <input type="text" id="date-code-input" class="other-input-field" placeholder="è«‹è¼¸å…¥é€±æœŸ" style="width: 100px; display: none; text-align: center;" onblur="revertToDateCodeSelect(this)">
                    </div>
                </td>
            </tr>
            <tr>
                <th>æŠ½æ¨£æ¨™æº–</th>
                <td colspan="3">MIL-STD-105D</td>
            </tr>
        </table>

        <div class="section-header">2. PCBè¦æ ¼</div>
        <table id="pcb-spec-table"> <tr>
                <th>æ¿æ</th>
                <td>
                    <div id="board-material-container">
                        <select onchange="toggleOtherInput(this, 'board-material-other-input')">
                            <option value="FR-4" selected>FR-4</option>
                            <option value="FR-1">FR-1</option>
                            <option value="é‹åŸºæ¿">é‹åŸºæ¿</option>
                            <option value="éŠ…åŸºæ¿">éŠ…åŸºæ¿</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="text" id="board-material-other-input" class="other-input-field" placeholder="è«‹è¼¸å…¥" style="width: 80px; display: none;" onblur="revertToSelect(this, 'board-material-container')">
                    </div>
                </td>
                <th>å±¤åˆ¥</th>
                <td>
                    <div id="layer-count-container">
                        <select onchange="toggleOtherInput(this, 'layer-count-other-input')">
                            <option value="å–®é¢æ¿">å–®é¢æ¿</option>
                            <option value="é›™é¢æ¿" selected>é›™é¢æ¿</option>
                            <option value="å››å±¤æ¿">å››å±¤æ¿</option>
                            <option value="å…­å±¤æ¿">å…­å±¤æ¿</option>
                            <option value="å…«å±¤æ¿">å…«å±¤æ¿</option>
                            <option value="åå±¤æ¿">åå±¤æ¿</option>
                            <option value="åäºŒå±¤æ¿">åäºŒå±¤æ¿</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="text" id="layer-count-other-input" class="other-input-field" placeholder="è«‹è¼¸å…¥" style="width: 80px; display: none;" onblur="revertToSelect(this, 'layer-count-container')">
                    </div>
                </td>
                <th>æ¿åš</th>
                <td>
                    <div id="thickness-container">
                        <select onchange="toggleOtherInput(this, 'thickness-other-input')">
                            <option value="0.4mm">0.4 mm</option>
                            <option value="0.6mm">0.6 mm</option>
                            <option value="0.8mm">0.8 mm</option>
                            <option value="1.0mm">1.0 mm</option>
                            <option value="1.2mm">1.2 mm</option>
                            <option value="1.6mm" selected>1.6 mm</option>
                            <option value="2.0mm">2.0 mm</option>
                            <option value="2.4mm">2.4 mm</option>
                            <option value="3.0mm">3.0 mm</option>
                            <option value="3.2mm">3.2 mm</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="text" id="thickness-other-input" class="other-input-field" placeholder="è«‹è¼¸å…¥" style="width: 80px; display: none;" onblur="revertToSelect(this, 'thickness-container')">
                    </div>
                </td>
            </tr>
            <tr>
                <th>å°ºå¯¸ (é•·)</th>
                <td><span class="editable placeholder-text" contenteditable="true" id="dim-length-input" oninput="enforceNumericalInput(this); updateSpecs();" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span> mm</td>
                <th>å°ºå¯¸ (å¯¬)</th>
                <td><span class="editable placeholder-text" contenteditable="true" id="dim-width-input" oninput="enforceNumericalInput(this); updateSpecs();" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span> mm</td>
                <th>æ’ç‰ˆæ•¸é‡</th>
                <td style="white-space: nowrap;"> <span class="pnl-input-span placeholder-text" contenteditable="true" id="pnl-x" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)" oninput="enforceNumericalInput(this)"></span> x 
                    <span class="pnl-input-span placeholder-text" contenteditable="true" id="pnl-y" onfocus="handlePlaceholderFocus(this)" onblur="handlePlaceholderBlur(this)" oninput="enforceNumericalInput(this)"></span> PCS / PNL
                </td>
            </tr>
            <tr>
                <th>é˜²ç„Šé¡è‰²</th>
                <td>
                    <div id="solder-mask-container">
                        <select onchange="toggleOtherInput(this, 'solder-mask-other-input')">
                            <option value="ç¶ è‰²" data-color="#006400">ğŸŸ¢ ç¶ è‰²</option>
                            <option value="ç™½è‰²" data-color="#ffffff">âšª ç™½è‰²</option>
                            <option value="ç´…è‰²" data-color="#8b0000">ğŸ”´ ç´…è‰²</option>
                            <option value="é»ƒè‰²" data-color="#ffd700">ğŸŸ¡ é»ƒè‰²</option>
                            <option value="è—è‰²" data-color="#1e90ff">ğŸ”µ è—è‰²</option>
                            <option value="é»‘è‰²" data-color="#000000">âš« é»‘è‰²</option>
                            <option value="éœ§é»‘è‰²" data-color="#333333">âš« éœ§é»‘è‰²</option>
                            <option value="ç´«è‰²" data-color="#8a2be2">ğŸŸ£ ç´«è‰²</option>
                            <option value="ç„¡é˜²ç„Š" data-color="#cccccc">ç„¡é˜²ç„Š</option> <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="text" id="solder-mask-other-input" class="other-input-field" placeholder="è«‹è¼¸å…¥" style="width: 80px; display: none;" onblur="revertToSelect(this, 'solder-mask-container')">
                    </div>
                </td>
                <th>æ–‡å­—é¡è‰²</th>
                <td>
                    <div id="legend-color-container">
                        <select onchange="toggleOtherInput(this, 'legend-color-other-input')">
                            <option value="ç™½è‰²" data-color="#ffffff">âšª ç™½è‰²</option>
                            <option value="é»‘è‰²" data-color="#000000">âš« é»‘è‰²</option>
                            <option value="ç„¡æ–‡å­—" data-color="#cccccc">ç„¡æ–‡å­—</option> <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="text" id="legend-color-other-input" class="other-input-field" placeholder="è«‹è¼¸å…¥" style="width: 80px; display: none;" onblur="revertToSelect(this, 'legend-color-container')">
                    </div>
                </td>
                <th>è¡¨é¢è™•ç†</th>
                <td>
                    <div id="surface-finish-container">
                        <select onchange="toggleOtherInput(this, 'surface-finish-other-input')">
                            <option value="æœ‰é‰›å™´éŒ«">æœ‰é‰›å™´éŒ«</option>
                            <option value="ç„¡é‰›å™´éŒ«" selected>ç„¡é‰›å™´éŒ«</option>
                            <option value="åŒ–é‡‘1u">åŒ–é‡‘1u"</option>
                            <option value="åŒ–é‡‘2u">åŒ–é‡‘2u"</option>
                            <option value="åŒ–é‡‘3u">åŒ–é‡‘3u"</option>
                            <option value="åŒ–é‡‘4u">åŒ–é‡‘4u"</option>
                            <option value="ç¡¬é‡‘3u">ç¡¬é‡‘3u"</option>
                            <option value="ç¡¬é‡‘5u">ç¡¬é‡‘5u"</option>
                            <option value="OSP">OSP</option>
                            <option value="è£¸éŠ…">è£¸éŠ…</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="text" id="surface-finish-other-input" class="other-input-field" placeholder="è«‹è¼¸å…¥" style="width: 80px; display: none;" onblur="revertToSelect(this, 'surface-finish-container')">
                    </div>
                </td>
            </tr>
        </table>

        <div class="section-header">3. æª¢é©—æ•¸æ“š</div>
        <div id="inspection-data-table-wrapper">
            <table id="inspection-data-table"> <thead>
                    <tr>
                        <th style="text-align: center;">é …ç›®</th>
                        <th style="text-align: center;">è¦æ ¼</th>
                        <th style="text-align: center;">æª¢é©—ç·¨è™Ÿ 1</th> <th style="text-align: center;">æª¢é©—ç·¨è™Ÿ 2</th> <th style="text-align: center;">æª¢é©—ç·¨è™Ÿ 3</th> <th style="text-align: center;">æª¢é©—ç·¨è™Ÿ 4</th> <th style="text-align: center;">æª¢é©—ç·¨è™Ÿ 5</th> <th style="text-align: center;">åˆ¤å®š</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-item="length">
                        <td>æˆå“é•·åº¦ (mm)</td>
                        <td>
                            <span contenteditable="true" class="editable-nominal" id="spec-length-nominal" oninput="populateAllInspectionData()"></span> 
                            <span class="tolerance-display" id="tol-display-length"> &plusmn; <span class="spec-tolerance" data-tolerance="0.2">0.2</span>mm</span>
                        </td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text judgment-field"></td> 
                    </tr>
                    <tr data-item="width">
                        <td>æˆå“å¯¬åº¦ (mm)</td>
                        <td>
                            <span contenteditable="true" class="editable-nominal" id="spec-width-nominal" oninput="populateAllInspectionData()"></span> 
                            <span class="tolerance-display" id="tol-display-width"> &plusmn; <span class="spec-tolerance" data-tolerance="0.2">0.2</span>mm</span>
                        </td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text judgment-field"></td> 
                    </tr>
                    <tr data-item="hole-1" id="row-hole-1">
                        <td>æˆå“å­”å¾‘ #1</td>
                        <td style="white-space: nowrap;">
                            <span contenteditable="true" class="editable-nominal placeholder-text" id="spec-hole1-nominal" 
                                  oninput="populateAllInspectionData()"
                                  onfocus="handlePlaceholderFocus(this)"
                                  onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span> 
                            <span class="tolerance-display" id="tol-display-hole1"> &plusmn; <span class="spec-tolerance" data-tolerance="0.05">0.05</span>mm</span>
                        </td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text judgment-field"></td> 
                    </tr>
                    <tr data-item="hole-2" id="row-hole-2">
                        <td>æˆå“å­”å¾‘ #2</td>
                        <td style="white-space: nowrap;">
                            <span contenteditable="true" class="editable-nominal placeholder-text" id="spec-hole2-nominal" 
                                  oninput="populateAllInspectionData()"
                                  onfocus="handlePlaceholderFocus(this)"
                                  onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span> 
                            <span class="tolerance-display" id="tol-display-hole2"> &plusmn; <span class="spec-tolerance" data-tolerance="0.05">0.05</span>mm</span>
                        </td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text judgment-field"></td> 
                    </tr>
                    <tr data-item="hole-3" id="row-hole-3">
                        <td>æˆå“å­”å¾‘ #3</td>
                        <td style="white-space: nowrap;">
                            <span contenteditable="true" class="editable-nominal placeholder-text" id="spec-hole3-nominal" 
                                  oninput="populateAllInspectionData()"
                                  onfocus="handlePlaceholderFocus(this)"
                                  onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span> 
                            <span class="tolerance-display" id="tol-display-hole3"> &plusmn; <span class="spec-tolerance" data-tolerance="0.05">0.05</span>mm</span>
                        </td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text judgment-field"></td> 
                    </tr>
                    <tr data-item="hole-4" id="row-hole-4">
                        <td>æˆå“å­”å¾‘ #4</td>
                        <td style="white-space: nowrap;">
                            <span contenteditable="true" class="editable-nominal placeholder-text" id="spec-hole4-nominal" 
                                  oninput="populateAllInspectionData()"
                                  onfocus="handlePlaceholderFocus(this)"
                                  onblur="handlePlaceholderBlur(this)">è«‹è¼¸å…¥</span> 
                            <span class="tolerance-display" id="tol-display-hole4"> &plusmn; <span class="spec-tolerance" data-tolerance="0.05">0.05</span>mm</span>
                        </td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td>
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text"><span class="editable data-field" contenteditable="true" oninput="checkJudgement(this)"></span></td> 
                        <td class="center-text judgment-field"></td> 
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="margin-top: 25px; border: 2px solid #000; text-align: center; background-color: #f9f9f9;" class="final-decision-box">
            <strong style="font-size: 16px;">æœ€çµ‚åˆ¤å®š: </strong>
            <span id="decision-ok" class="decision-inactive" style="font-size: 20px; margin-left: 20px;">&#9744; åˆæ ¼</span>
            <span id="decision-ng" class="decision-inactive" style="font-size: 20px; margin-left: 20px;">&#9744; ä¸åˆæ ¼</span>
        </div>

<div class="footer-section" contenteditable="false">
            
            <div class="signature-box" style="border-top: none; padding-top: 0;"> 
                <div style="height: 80px; display: flex; justify-content: center; align-items: center;">
                    <img src="pic/reviewer.png" 
                         alt="æª¢é©—ç°½å/è“‹ç« " 
                         style="width: 100%; height: auto; object-fit: contain;"> 
                </div>
                <div style="border-top: 1px solid #000; padding-top: 5px;">æª¢é©—äººå“¡</div> 
            </div>
            
            <div class="signature-box" style="border-top: none; padding-top: 0;">
                <div style="height: 80px; display: flex; justify-content: center; align-items: center;">
                    <img src="pic/approver.png" 
                         alt="æ ¸å‡†ç°½å/è“‹ç« " 
                         style="width: 100%; height: auto; object-fit: contain;">
                </div>
                <div style="border-top: 1px solid #000; padding-top: 5px;">æ ¸å‡†äººå“¡</div>
            </div>
        </div>
    <script>
        const today = new Date();
        const dateStr = today.getFullYear() + '-' + 
                        String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(today.getDate()).padStart(2, '0');
        document.getElementById('inspectionDate').value = dateStr;

        function toggleOtherInput(selectElement, inputId) {
            const inputElement = document.getElementById(inputId);
            
            if (selectElement.value === 'å…¶ä»–') {
                inputElement.style.display = 'inline-block';
                selectElement.style.display = 'none';
                inputElement.focus();
            } else {
                inputElement.style.display = 'none';
                selectElement.style.display = 'inline-block';
                inputElement.value = ''; 
            }
            checkCompletion(); 
        }
        
        function revertToSelect(inputElement, containerId) {
            const container = document.getElementById(containerId);
            const selectElement = container.querySelector('select');

            if (inputElement.value.trim() === '') {
                inputElement.style.display = 'none';
                selectElement.style.display = 'inline-block';
                if (selectElement.value === 'å…¶ä»–') {
                    selectElement.selectedIndex = 0; 
                }
            }
            checkCompletion(); 
        }

        function toggleDateCodeInput(selectElement) {
            let inputElement = document.getElementById('date-code-input');

            if (selectElement.value === 'has') {
                selectElement.style.display = 'none';
                inputElement.style.display = 'inline-block';
                inputElement.value = ''; 
                inputElement.focus();
            } else {
                inputElement.style.display = 'none';
                selectElement.style.display = 'inline-block';
                inputElement.value = '';
            }
            checkCompletion(); 
        }

        function revertToDateCodeSelect(inputElement) {
            if (inputElement.value.trim() === '') {
                const selectElement = document.getElementById('date-code-select');
                inputElement.style.display = 'none';
                selectElement.style.display = 'inline-block';
                selectElement.value = 'none';
            }
            checkCompletion(); 
        }
        
        function handlePlaceholderFocus(el) {
            if (el.textContent.trim() === 'è«‹è¼¸å…¥' || el.placeholder === 'è«‹è¼¸å…¥' || el.placeholder === 'è«‹è¼¸å…¥é€±æœŸç¢¼') {
                el.textContent = '';
                el.placeholder = ''; 
                el.classList.remove('placeholder-text');
            }
        }

        function handlePlaceholderBlur(el) {
            const originalText = el.textContent.trim();
            
            if (originalText === '' || originalText === 'è«‹è¼¸å…¥' || originalText === 'è«‹è¼¸å…¥é€±æœŸç¢¼') {
                let placeholderText = 'è«‹è¼¸å…¥';
                if (el.id === 'date-code-input' || el.placeholder === 'è«‹è¼¸å…¥é€±æœŸç¢¼') {
                    placeholderText = 'è«‹è¼¸å…¥é€±æœŸç¢¼';
                }

                if (el.tagName === 'SPAN') {
                    el.textContent = placeholderText; 
                    el.classList.add('placeholder-text');
                }
                
                if (el.tagName === 'INPUT') {
                     el.placeholder = placeholderText;
                     el.value = '';
                }
                
                el.dispatchEvent(new Event('input')); 
            } else {
                 el.classList.remove('placeholder-text');
            }
            checkCompletion(); 
        }

        function enforceNumericalInput(el) {
            let value = el.textContent.trim();
            
            value = value.replace(/[^\d.]/g, ''); 
            
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }

            if (el.textContent !== value) {
                el.textContent = value;
            }
            checkCompletion(); 
        }

        function checkCompletion() {
            let allFilled = true;

            const requiredTextIds = ['customer-name', 'customer-part'];
            requiredTextIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const value = el.textContent.trim();
                    if (value === 'è«‹è¼¸å…¥' || value === '') {
                        allFilled = false;
                    }
                }
            });

            const requiredNumberIds = ['qty-input', 'dim-length-input', 'dim-width-input', 'pnl-x', 'pnl-y'];
            requiredNumberIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const value = el.textContent.trim();
                    const numValue = parseFloat(value);
                    if (value === 'è«‹è¼¸å…¥' || value === '' || !isFinite(numValue)) { 
                        allFilled = false;
                    }
                }
            });

            const dateCodeSelect = document.getElementById('date-code-select');
            const dateCodeInput = document.getElementById('date-code-input');
            if (dateCodeSelect.value === 'has') {
                if (dateCodeInput.value.trim() === '' || dateCodeInput.value.trim() === 'è«‹è¼¸å…¥é€±æœŸç¢¼') {
                    allFilled = false;
                }
            }

            const okSpan = document.getElementById('decision-ok');
            const ngSpan = document.getElementById('decision-ng');

            if (allFilled) {
                okSpan.innerHTML = '&#9745; åˆæ ¼';
                okSpan.classList.add('decision-qualified-active');
                okSpan.classList.remove('decision-inactive');
                ngSpan.innerHTML = '&#9744; ä¸åˆæ ¼';
            } else {
                okSpan.innerHTML = '&#9744; åˆæ ¼';
                okSpan.classList.remove('decision-qualified-active');
                okSpan.classList.add('decision-inactive');
                ngSpan.innerHTML = '&#9744; ä¸åˆæ ¼';
            }
        }

        function prepareForPrint() {
            let missingFields = [];
            let allFilled = true;

            const requiredTextIds = ['customer-name', 'customer-part'];
            const requiredNumberIds = ['qty-input', 'dim-length-input', 'dim-width-input', 'pnl-x', 'pnl-y'];
            const nameMap = {
                'customer-name': 'å®¢æˆ¶åç¨±',
                'customer-part': 'å®¢æˆ¶æ–™è™Ÿ',
                'qty-input': 'å‡ºè²¨æ•¸é‡',
                'dim-length-input': 'å°ºå¯¸(é•·)',
                'dim-width-input': 'å°ºå¯¸(å¯¬)',
                'pnl-x': 'æ’ç‰ˆ X æ•¸é‡',
                'pnl-y': 'æ’ç‰ˆ Y æ•¸é‡'
            };

            document.querySelectorAll('.missing').forEach(el => el.classList.remove('missing'));

            requiredTextIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const value = el.textContent.trim();
                    if (value === 'è«‹è¼¸å…¥' || value === '') {
                        el.classList.add('missing');
                        allFilled = false;
                        missingFields.push(nameMap[id] || id);
                    }
                }
            });

            requiredNumberIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const value = el.textContent.trim();
                    const numValue = parseFloat(value);
                    if (value === 'è«‹è¼¸å…¥' || value === '' || !isFinite(numValue)) { 
                        el.classList.add('missing');
                        allFilled = false;
                        missingFields.push(nameMap[id] || id);
                    }
                }
            });
            
            const dateCodeSelect = document.getElementById('date-code-select');
            const dateCodeInput = document.getElementById('date-code-input');
            if (dateCodeSelect.value === 'has') {
                if (dateCodeInput.value.trim() === '' || dateCodeInput.value.trim() === 'è«‹è¼¸å…¥é€±æœŸç¢¼') {
                     dateCodeInput.classList.add('missing');
                     allFilled = false;
                     missingFields.push('é€±æœŸä»£ç¢¼');
                }
            }
            
            if (allFilled) {
                const inspectionRowsHidden = hideEmptyInspectionRows();
                window.print();
                setTimeout(() => restoreHiddenInspectionRows(inspectionRowsHidden), 500); 
            } else {
                showModal('è«‹å¡«å¯«ä»¥ä¸‹å¿…å¡«æ¬„ä½ï¼Œç´…æ¡†è™•ç‚ºå¿…å¡«:\n' + missingFields.join('\n'));
            }
        }
        
        function hideEmptyInspectionRows() {
            let hiddenRows = [];
            for (let i = 1; i <= 4; i++) {
                const nominalId = `spec-hole${i}-nominal`;
                const rowId = `row-hole-${i}`;
                const nominalEl = document.getElementById(nominalId);
                const rowEl = document.getElementById(rowId);

                if (nominalEl && rowEl) {
                    const nominalValue = nominalEl.textContent.trim();
                    const isPlaceholder = nominalEl.classList.contains('placeholder-text');

                    if (isPlaceholder || nominalValue === '' || nominalValue === 'è«‹è¼¸å…¥') {
                        rowEl.classList.add('hide-on-print');
                        hiddenRows.push(rowEl);
                    } else {
                        rowEl.classList.remove('hide-on-print');
                    }
                }
            }
            return hiddenRows;
        }

        function restoreHiddenInspectionRows(hiddenRows) {
             hiddenRows.forEach(row => row.classList.remove('hide-on-print'));
        }

        function parseSpec(nominalId) {
            const nominalEl = document.getElementById(nominalId);
            const toleranceDisplayEl = nominalEl.nextElementSibling; 

            if (!nominalEl || !toleranceDisplayEl || !toleranceDisplayEl.classList.contains('tolerance-display')) return null;

            const toleranceEl = toleranceDisplayEl.querySelector('.spec-tolerance');

            if (!toleranceEl) return null;

            const nominalStr = nominalEl.textContent.trim();
            const toleranceStr = toleranceEl.getAttribute('data-tolerance'); 
            
            const nominal = parseFloat(nominalStr);
            const tolerance = parseFloat(toleranceStr);

            if (nominalStr === '' || isNaN(nominal) || nominalStr === 'è«‹è¼¸å…¥') {
                toleranceDisplayEl.style.display = 'none';
                return null;
            } else {
                toleranceDisplayEl.style.display = 'inline-block';
            }

            if (isNaN(nominal) || isNaN(tolerance)) return null;

            const toleranceDecimals = toleranceStr.split('.')[1]?.length || 0;
            const decimals = toleranceDecimals;

            return { nominal, tolerance, decimals };
        }

        function generateRandomData(nominal, tolerance, decimals, rowIndex) {
            let val;
            
            if (rowIndex === 0 || rowIndex === 1) {
                const maxDeviation = 0.11;     
                const tightLimit = 0.08;       
                const negativeChance = 0.15;   
                const tightDistributionChance = 0.60; 
                
                let deviation;
                const isTight = Math.random() < tightDistributionChance;
                
                if (isTight) {
                    deviation = Math.random() * tightLimit;
                } else {
                    deviation = Math.random() * (maxDeviation - tightLimit) + tightLimit;
                }
                
                const isNegative = Math.random() < negativeChance;
                
                if (isNegative) {
                    val = nominal - deviation;
                } else {
                    val = nominal + deviation;
                }
                
                return val.toFixed(2); 
            } 
            else if (rowIndex >= 2) {
                const min = nominal;
                const max = nominal + 0.03;
                
                val = Math.random() * (max - min) + min;
                return val.toFixed(decimals);
            }
            
            const min = nominal - tolerance;
            const max = nominal + tolerance;
            val = Math.random() * (max - min) + min;
            return val.toFixed(decimals);
        }

        function populateAllInspectionData() {
            populateRowData(0, 'spec-length-nominal');
            populateRowData(1, 'spec-width-nominal');
            populateRowData(2, 'spec-hole1-nominal');
            populateRowData(3, 'spec-hole2-nominal');
            populateRowData(4, 'spec-hole3-nominal');
            populateRowData(5, 'spec-hole4-nominal');
        }

        function populateRowData(rowIndex, nominalId) {
            const parsed = parseSpec(nominalId);
            
            const tbody = document.getElementById('inspection-data-table').querySelector('tbody');
            const row = tbody.rows[rowIndex];
            
            if (!row) return;

            const judgementCell = row.cells[7]; 
            
            if (!parsed) {
                for (let i = 2; i <= 6; i++) { 
                    const dataCellSpan = row.cells[i].querySelector('span.editable');
                    if (dataCellSpan) dataCellSpan.textContent = '';
                }
                judgementCell.textContent = '';
                return;
            }

            let allDataPresent = true;
            for (let i = 2; i <= 6; i++) { 
                const dataCellSpan = row.cells[i].querySelector('span.editable');
                if (dataCellSpan) {
                    dataCellSpan.textContent = generateRandomData(parsed.nominal, parsed.tolerance, parsed.decimals, rowIndex);
                } else {
                    allDataPresent = false;
                }
            }
            
            if (allDataPresent) {
                judgementCell.textContent = 'OK';
            } else {
                judgementCell.textContent = '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('select').forEach(select => {
                const inputId = select.id ? select.id.replace('-select', '-other-input') : '';
                const inputElement = document.getElementById(inputId);

                if (select.value === 'å…¶ä»–' && inputElement) {
                    toggleOtherInput(select, inputId);
                }
            });
            
            updateSpecs();
            
            document.getElementById('spec-length-nominal')?.addEventListener('input', populateAllInspectionData);
            document.getElementById('spec-width-nominal')?.addEventListener('input', populateAllInspectionData);
            document.getElementById('spec-hole1-nominal')?.addEventListener('input', populateAllInspectionData);
            document.getElementById('spec-hole2-nominal')?.addEventListener('input', populateAllInspectionData);
            document.getElementById('spec-hole3-nominal')?.addEventListener('input', populateAllInspectionData);
            document.getElementById('spec-hole4-nominal')?.addEventListener('input', populateAllInspectionData);
            
            document.querySelector('.page-container').addEventListener('input', checkCompletion);
            document.querySelectorAll('select').forEach(sel => sel.addEventListener('change', checkCompletion));

            const editables = document.querySelectorAll('[contenteditable="true"]');
            editables.forEach(el => {
                el.addEventListener('click', (e) => {
                    el.focus();
                });
                el.addEventListener('touchstart', (e) => {
                    el.focus();
                }, {passive: true});
            });
            
            checkCompletion(); 
        });
        
        function showModal(message) {
            let modal = document.getElementById('custom-alert-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'custom-alert-modal';
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0, 0, 0, 0.5); z-index: 1000; 
                    display: flex; justify-content: center; align-items: center;
                `;
                modal.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); max-width: 90%; width: 400px;">
                        <p id="custom-alert-message" style="white-space: pre-wrap; margin-bottom: 20px; font-size: 14px;"></p>
                        <button onclick="document.getElementById('custom-alert-modal').style.display='none'" 
                                style="background: #3b82f6; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; float: right;">
                            ç¢ºèª
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            document.getElementById('custom-alert-message').textContent = message;
            modal.style.display = 'flex';
        }

    </script>
</body>
</html>
